MI.define("module/TalkBox",["TalkBoxRich","Base"],function(){var l=UI.G,g=UI.GC,v=MI.token();window.requestAnimateFrame||(window.requestAnimateFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1E3/60)});UI.indexOf=function(a,b){var c,f;f="\x00"+a.join("\x00")+"\x00";c=f.indexOf("\x00"+b+"\x00");return c==-1?-1:f.slice(0,c).replace(/[^\0]/g,"").length};UI.swap=function(a,b,c){var b=UI.indexOf(a,b),c=UI.indexOf(a,c),f;if(!(b==-1||c==-1)){f=a[b];a[b]=a[c];a[c]=f}};UI.unique=function(a){var b={},c=[];if(!a)return[];for(var f=0;f<a.length;f++)b[a[f]]=1;UI.each(b,function(a,b){c.push(b)});return c};UI.extend=function(){for(var a=arguments,b=a[0],c=1;c<a.length;c++){var f=a[c];if(f)for(var e in f)UI.isObject(b[e])&&UI.isObject(f[e])?UI.extend(b[e],f[e]):b[e]=f[e]}return b};UI.flicker=function(a,b){if(a){var c=parseInt(UI.A(a,"delay"),10);c&&clearTimeout(c);UI.show(a);c=setTimeout(function(){UI.animate(a,"opacity",0,function(){UI.hide(a);UI.C(a,"opacity",1)},0.3)},b);UI.A(a,"delay",c)}};MI.NewTalkBox=function(a,b){MI.versionSet({_MusicRecord2:"130816",_VideoRecord2:"131129",_PingtuEditor2:"130924a",_MultiPicBtn:"140312",_MakeUpPic:"140109"});var c=new MI.TalkBox(a,b),f;for(f in MI.NewTalkBox.prototype)MI.NewTalkBox.prototype.hasOwnProperty(f)&&(c[f]=MI.NewTalkBox.prototype[f]);c.picsNum=0;c.maxPics=9;var e=setInterval(function(){c.addEvent();if(c._pic){c.overrides.TalkBox(c);c._addDraft();clearInterval(e)}},50);MI.TalkBox.showDraft(c);c._addLinkEvent();return c};var oa=MI.NewTalkBox,pa=RegExp("((((((ht){1}tps?)://)|(www))[-a-zA-Z0-9@:%_+.~#?&//=]+)|([0-9a-zA-Z].*?@([0-9a-zA-Z].*.w{2,4})))","g"),C,n={},V={},ea=function(a,b,c){var f=g(l(a),".pic img")[0],e=g(l(a),".op")[0];UI.A(l(a),"loaded","1");UI.A(f,"rotateUrl",b);UI.removeClass(e,"rotating");UI.show(e);f=n[a].pics[(n[a].pos+3)%4];f=f.replace(/\/\d{1,}$/g,"");f=UI.indexOf(C.pics,f);C.pics[f]=b.replace(/\/\d{1,}$/g,"");C._pushPicIdMap(C.pics[f],a);C._paths[f]=c;MI.S("draft_pics_"+MI.Uin(),UI.json2str(C.pics));MI.S("draft_paths_"+MI.Uin(),UI.json2str(C._paths))},fa,W=!1,qa=UI.DC("div").style,X;UI.each(["OTransform","msTransform","WebkitTransform","MozTransform"],function(a){if(!UI.isUndefined(qa[a])){W=true;return 1}});X=(W?"":"_")+"rotate";fa=function(a,b){var c=g(l(a),".pic img")[0],f=g(l(a),".op")[0],b=b*90;b===0&&(b=360);UI.A(l(a),"loaded","0");UI.hide(f);UI.addClass(f,"rotating");setTimeout(function(){UI.A(c,"class","");UI.addClass(c,"rotate");UI.addClass(c,X+b)},0);b===360&&setTimeout(function(){b=0;UI.A(c,"class","");UI.addClass(c,"notran");UI.addClass(c,X+b)},210);if(!W){UI.C(c,"filter","progid:DXImageTransform.Microsoft.BasicImage(Rotation="+b/90+")");var f=UI.A(c,"l")||UI.C(c,"top"),e=UI.A(c,"t")||UI.C(c,"left");UI.C(c,"marginLeft",f);UI.C(c,"top","");UI.C(c,"marginTop",e);UI.C(c,"left","");UI.C(c,"zoom","1");UI.A(c,"l",UI.C(c,"marginTop"));UI.A(c,"t",UI.C(c,"marginLeft"))}};V.reset=function(){};V.rotate=function(a,b,c,f){C=f;n[a]||(n[a]={});if(UI.isUndefined(n[a].pos)){n[a].pos=0;n[a].pics=[c];n[a].paths=[b]}n[a].pos=(n[a].pos+1)%4;c=n[a].pics[n[a].pos];f=n[a].paths[n[a].pos];fa(a,n[a].pos);if(c)ea(a,c,f);else{c=n[a].pos;f=b.match(/upload(\d*)\.t\.qq\.com/g);f=["http://",f?f[0]:"upload.t.qq.com","/asyn/rotatepic.php"].join("");MI.ajax({url:f,type:"post",data:{retType:1,path:b,degrees:c*90,picId:a},success:function(b){b=MI.json(b);if(b.result===0){var c=b.info.image+"/460",f=b.info.path||"";if(n[a]){n[a].pics.push(c);n[a].paths.push(f);ea(a,c,f)}}else MI.alert(b.msg);C.picWait(b)}})}};var h,u={},J,K,L,O,P,r,w,A,t,Q,R=[],Y="",D,M,ga,E,G=0,ia=function(a,b,c,f,e){UI.C(a,"overflow","hidden");var d=false,g=parseInt(UI.C(UI.children(a)[0],"width").replace("px",""),10)-a.scrollLeft-c;if(!window.requestAnimateFrame)window.requestAnimateFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1E3/60)};if(g-c<0&&b=="right"||a.scrollLeft===0&&b=="left")e&&e();else if(d)e&&e();else{var p=+new Date,z=a.scrollLeft,ha=function(){var g,i=(+new Date-p)/400;if(i<1){g=Math.sin(i*0.5*Math.PI);var k;b=="right"?k=z+c*g:b=="left"&&(k=z-c*g);a.scrollLeft=k;window.requestAnimateFrame(ha)}else{b=="right"?g=z+c:b=="left"&&(g=z-c);a.scrollLeft=g;d=false;if(f){k=parseInt(UI.C(UI.children(a)[0],"width").replace("px",""),10)-a.scrollLeft-c;f(a,k-c,b)}e&&e()}},d=true;window.requestAnimateFrame(ha)}},ja=function(a,b,c){var f=_("上一张"),e=_("下一张");D=parseInt(O.innerHTML,10);if(b<0){UI.addClass(K,"btnDefault");UI.A(K,"title","")}else{UI.removeClass(K,"btnDefault");UI.A(K,"title",e)}if(a.scrollLeft===0){UI.addClass(J,"btnDefault");UI.A(J,"title","")}else{UI.removeClass(J,"btnDefault");UI.A(J,"title",f)}if(c==u.LEFT){O.innerHTML=D-1;D--}else if(c==u.RIGHT){O.innerHTML=D+1;D++}},Z=function(){var a=r;a.style.display=="none"&&(a=w);UI.C(a,"height","");if(a.scrollHeight>24){UI.C(r,"height","36px");UI.C(w,"height","36px")}else{UI.C(r,"height","");UI.C(w,"height","")}},ra={".del":function(a,b,c){a.prevent();UI.remove(c.urlParsePrev);c.urlAjax=null;c.urlParsePrev=null;R.push(Y);R=UI.unique(R);c.dealPrevArea()},".btnLeft":function(a,b,c){a.prevent();if(!G){G=1;ia(P,c.parseUrl.LEFT,120,ja,function(){G=0})}},".btnRight":function(a,b,c){a.prevent();if(!G){G=1;ia(P,c.parseUrl.RIGHT,120,ja,function(){G=0})}},".urlCheck input":function(){var a=this.checked,b=UI.parent(P),c=g(h.urlParsePrev,".urlCheck .tips")[0],f=[_("显示当前图片"),_("显示图片")];if(a){UI.show(b);UI.removeClass(h.urlParsePrev,"urlParseNoPic");c.innerHTML=f[0];E=33}else{UI.hide(b);UI.addClass(h.urlParsePrev,"urlParseNoPic");c.innerHTML=f[1];E=44}Z();t.value=A.innerHTML=MI.string.cut(t.value,(E-1)*2,"")},".urlTitBox a":function(){},".urlSumBox a":function(){}};u.enable=MI.user.fun.parseUrl;u.LEFT="left";u.RIGHT="right";u.Tips={noTit:_("请输入文章标题"),noDesc:_("请输入文章摘要"),none:_("请输入文章标题和摘要")};u.parse=function(a,b){h=b;if(h.statusTmpl){a.liW=120;a.title=MI.string.cut(a.title,78,"");M=a.pics=a.pics||[];E=44;M.length>0&&(E=33);a.desc=MI.string.cut(a.desc,(E-2)*2,"");ga=a.host;h.urlParsePrev=UI.html(UI.txTpl('<div class="urlParse clear <%if(pics.length==0){%>urlParseNoPic<%}%>"><%if(pics.length>0){%><div class="urlParsePic"><div class="picList"><ul class="slidePic clear" style="width:<%=liW*pics.length%>px;"><%for(var i=0;i<pics.length;i++){%><li><img src="<%=pics[i]%>"></li><%}%></ul></div><div class="slideCtrl"><a href="#" class="slideBtn btnLeft btnDefault"><em class="a a_r a4"></em></a><span class="slideNum"><span class="cur">1</span>/<%=pics.length%></span><a href="#" class="slideBtn btnRight <%if(pics.length==1){%>btnDefault<%}%>" <%if(pics.length>1){%>title="下一张"<%}%>><em class="a a_l a4"></em></a></div></div><%}%><div class="urlParseText"><div class="urlEditBtn"><a href="#x" class="btn_remove del" title="删除">×</a></div><div class="editWrap"><div class="urlTitBox"><a class="urlTit" style="width:100%;"><%=title%></a><textarea class="urlTit" style="display:none;"></textarea></div></div><div class="editWrap"><div class="urlSumBox"><a class="urlSummary" style="width:100%;"><%=desc%></a><input type="text" class="urlSummary" style="display:none;"></input></div></div><p class="urlLink"><%=host%></p><p class="urlCheck"><label class="showPic" <%if(!pics.length){%>style="display:none;"<%}%>><input type="checkbox" class="check1" checked><span class="tips">显示当前图片</span></label><span class="error" style="display:none;"></span></p></div></div>',a))[0];D=1;Y=a.url;J=g(h.urlParsePrev,".btnLeft")[0];K=g(h.urlParsePrev,".btnRight")[0];L=g(h.urlParsePrev,".urlCheck input")[0];O=g(h.urlParsePrev,".slideNum .cur")[0];P=g(h.urlParsePrev,".picList")[0];r=g(h.urlParsePrev,".urlTitBox textarea")[0];w=g(h.urlParsePrev,".urlTitBox a")[0];t=g(h.urlParsePrev,".urlSumBox input")[0];A=g(h.urlParsePrev,".urlSumBox a")[0];g(h.urlParsePrev,".urlParseText");Q=g(h.urlParsePrev,".error")[0];r.value=UI.text(w);t.value=UI.text(A);UI.append(h.urlParsePrev,h._sendStatusUrl);UI.show(h._sendStatusUrl);UI.show(h._talkBoxStatus);Z();var c=_("点击编辑"),f="",e,d=function(a,b,c){var d,g=UI.parent(a),s;d=MI.string.length(a.value);c.type=="keydown"&&(e=MI.cursorX(a));if(d<=b*2&&c.type=="keydown")f=a.value;if(d>b*2){UI.addClass(g,"urlWarning");clearTimeout(h.delay.flash);h.delay.flash=setTimeout(function(){UI.removeClass(g,"urlWarning")},500);s=" ";e=e||MI.cursorX(a);a.value=f;MI.selectTxt(a,e,e,e)}else if(d!==0){UI.removeClass(g,"urlWarning");UI.removeClass(g,"urlWarning2")}a=MI.countTxt(r.value);b=MI.countTxt(t.value);if(a===0){s=h.parseUrl.Tips.noTit;g=UI.parent(r);UI.addClass(g,"urlWarning2")}if(b===0){s=h.parseUrl.Tips.noDesc;g=UI.parent(t);UI.addClass(g,"urlWarning2")}if(a===0&&b===0)s=h.parseUrl.Tips.none;if(s){Q.innerHTML=s;UI.show(Q)}else UI.hide(Q)},k=function(a,b){var c=UI.parents(a,"editWrap")[0];if(b.type=="focus"){UI.show(a);UI.addClass(c,"urlParseTextEdit");UI.A(r,"title","");UI.A(t,"title","");a==r?UI.hide(w):a==t&&UI.hide(A);setTimeout(function(){a.select()},10)}else if(b.type=="blur"){UI.removeClass(c,"urlParseTextEdit");UI.hide(a);if(a==r){UI.show(w);w.innerHTML=a.value}else if(a==t){UI.show(A);A.innerHTML=a.value}}};UI.each(["keypress","keydown","keyup","paste","input","cut","focus","blur"],function(a){UI.EA(r,a,function(a){clearTimeout(h.delay.blur);a.type=="keypress"&&a.keyCode==13&&UI.E(a).prevent();d(r,40,a);k(r,a);Z()});UI.EA(t,a,function(a){clearTimeout(h.delay.blur);a.type=="keypress"&&a.keyCode==13&&UI.E(a).prevent();E=L&&L.checked&&M.length>0?33:44;d(t,E,a);k(t,a)})});w.onmouseover=function(){UI.A(w,"title",c)};w.onmouseout=function(){UI.A(w,"title","")};A.onmouseover=function(){UI.A(A,"title",c)};A.onmouseout=function(){UI.A(A,"title","")};w.onmousedown=function(){UI.fireEvent(r,"focus");return false};A.onmousedown=function(){UI.fireEvent(t,"focus");return false};h.addProxyEvent(ra,h.urlParsePrev);h.dealPrevArea()}else h.urlAjax=null};u.getUrl=function(a){if(!a)return[];UI.each(R,function(b){b=UI.indexOf(a,b);b!=-1&&a.splice(b,1)});return a};u.isEmpty=function(){return r.value===""&&t.value===""?-3:r.value===""?-1:t.value===""?-2:0};u.getParse=function(){var a="";L&&L.checked&&(a=M[D>M.length?0:D-1]||"");return{url2richtitle:r.value,url2richdesc:t.value,url2richpic:a,url2richurl:Y,url2richhost:ga}};u.delParse=function(a){h=a;h.urlParsePrev&&UI.remove(h.urlParsePrev);h.urlAjax=null;h.urlParsePrev=null;h.dealPrevArea()};var $=function(){N();if(UI.indexOf(S,d._txt.value)!=-1&&UI.A(d._txt,"voteGuide")){d._txt.value="";d.countTxt();UI.A(d._txt,"voteGuide",0)}UI.hide(d._sendStatusVote);UI.hide(d._talkBoxStatus)},N=function(){d.maxPics=9;j.delPic();var a=g(B,".myTime")[0];H.value=aa;a&&UI.hide(a);d.attachStatus=0;d.disablePuzzleAttach(false);v=MI.token()},ka=function(){var a="";d.picsNum===1?a=S[0]:d.picsNum>1&&(a=S[1]);if(d._txt.value===""||UI.A(d._txt,"voteGuide"))if(UI.indexOf(S,d._txt.value)!=-1||d._txt.value==d.guideTextValue){d._txt.value=a;d.countTxt();a=d._txt.value.length;MI.selectTxt(d._txt,0,a,a);UI.A(d._txt,"voteGuide",1)}},d,B,H,ba,j={},I,aa=0,T=!1,la="draft_picvote_"+MI.Uin(),ma="cross_page_sendpv_"+MI.Uin(),S=["喜欢么？","哪一个？",""],na=0,ca=0,U=null,da,sa={click:{".closeBtn":function(a){if(j.getPicVote().votes.length===0)$();else{d._boss("showPicVoteCloseConfirm");MI.confirm({title:_("确定退出图片投票？"),content:_("关闭后图片不再保存"),confirmTxt:_("确定"),confirm:function(){MI.dialog.hide();$();d._boss("btnPicVoteCloseConfirmOK")},cancelTxt:_("取消"),cancel:function(){d._boss("btnPicVoteCloseConfirmNO")}})}d._boss("btnPicVoteClose");a.prevent()},".control .calendar":function(a){MI.app("DatePicker",function(){UI.DatePicker.show(a,{format:"yyyy-MM-dd",target:l("js_calendar"),startDay:da})});a.prevent()},".addMoreBlock .soso":function(a){d._sosoPic(d._picVoteAnchor,1);d._boss("btnPicVoteSoso");a.prevent()},".addMoreBlock .snap":function(a){d._capturePic();d._boss("btnPicVoteSnap");a.prevent()},".item .makeUpPic":function(a,b){var c=UI.parents(b,"item")[0];T=false;d.makeUpPic(c.id);d._boss("btnPicVoteMakeUp");a.prevent()},".item .picCut":function(a,b){var c=UI.parents(b,"item")[0];T=true;d.makeUpPic(c.id);d._boss("btnPicVoteCut");a.prevent()},".operate .editor":function(a,b){var c=UI.parents(b,"item")[0];I.show(c,b);a.prevent()},".listen label":function(){d._boss("btnPicVoteFollow")}},change:{".control .end_time_select":function(a,b){var c=g(B,".myTime")[0];if(b.value==4){l("js_calendar").value=da;l("js_hour").value="23";l("js_min").value="00";UI.show(c)}else UI.hide(c)}}},F=function(a){this.body=a;this.curLi=null;this.arrow=g(this.body,".caret")[0];this.descTi=g(this.body,".addIntro .desc")[0];this.urlTi=g(this.body,".addIntro .url")[0];this.optionTmpl='<a href="#" class="<%=css%> tx_nowrap" title="<%=cont%>"><%=cont%></a><a href="#" class="b2_ic ic_edit" title="修改">[修改]</a>';UI.delegate(this._eventsMap,this.body,this)};F.prototype.CONST={DEFAULT_DESC_TEXT:"添加图片描述",DEFAULT_URL_TEXT:"添加链接",MAX_DESC:10,MAX_URL:1};F.prototype._eventsMap={click:{".optintro .ok":function(a,b,c){var a=c.check(),f=true;UI.each(a,function(a){a!==0&&(f=false)});if(f){UI.hide(c.body);j.toggleOp(1);c.updateTxt(c.descTi.value,c.urlTi.value)}},".optintro .no":function(a,b,c){if(c.descTi.value!=c.srcDesc||c.urlTi.value!=c.srcUrl)MI.confirm({title:_("确定退出编辑？"),content:_("退出后编辑内容不再保存"),confirmTxt:_("确定"),confirm:function(){UI.hide(c.body);j.toggleOp(1);MI.dialog.hide()},cancelTxt:_("取消")});else{UI.hide(c.body);j.toggleOp(1)}}},focus:{".addIntro .desc":function(a,b,c){UI.addClass(b,"focus");if(b.value==c.CONST.DEFAULT_DESC_TEXT)b.value=""},".addIntro .url":function(a,b,c){UI.addClass(b,"focus");if(b.value==c.CONST.DEFAULT_URL_TEXT)b.value=""}},blur:{".addIntro .desc":function(a,b,c){UI.removeClass(b,"focus");if(b.value.replace(/^\s+$/g,"")==="")b.value=c.CONST.DEFAULT_DESC_TEXT},".addIntro .url":function(a,b,c){UI.removeClass(b,"focus");if(b.value.replace(/^\s+$/g,"")==="")b.value=c.CONST.DEFAULT_URL_TEXT}},"input,keyup":{".addIntro .desc":function(a,b,c){a=c.check();b=UI.next(b);if(a.desc===-1){UI.addClass(b,"error");b.innerHTML="已超过10个汉字";d._boss("showPicVoteDescLong")}else{b.innerHTML="不超过10个汉字";UI.removeClass(b,"error")}},".addIntro .url":function(a,b,c){a=c.check();b=UI.next(b);if(a.url===-1){UI.addClass(b,"error");d._boss("showPicVoteUrlMore")}else UI.removeClass(b,"error")}}};F.prototype.show=function(a,b){this.curLi=a;this.editEl=g(this.curLi,".voteEdit")[0];this.descEl=g(this.curLi,".voteDesc a")[0];this.urlEl=g(this.curLi,".voteUrl a")[0];this.srcDesc=this.descTi.value=this.descEl.innerHTML;this.srcUrl=this.urlTi.value=this.urlEl.innerHTML;var c=UI.next(g(this.body,".addIntro .desc")[0]),f=UI.next(g(this.body,".addIntro .url")[0]);c.innerHTML="不超过10个汉字";UI.removeClass(c,"error");UI.removeClass(f,"error");UI.show(this.body);this.fixArrowPos();j.toggleOp(0);if(UI.hasClass(b,"voteDesc")){MI.focus(this.descTi);d._boss("btnPicVoteDesc")}else if(UI.hasClass(b,"voteUrl")){MI.focus(this.urlTi);d._boss("btnPicVoteUrl")}else{MI.focus(this.descTi);d._boss("btnPicVoteEdit")}};F.prototype.fixArrowPos=function(){var a=this.curLi;if(a){a=UI.getX(a)-UI.getX(this.body)+(UI.width(a)-UI.width(this.arrow))/2;UI.C(this.arrow,"left",a+"px")}};F.prototype.set=function(a,b,c){this.curLi=a;this.editEl=g(this.curLi,".voteEdit")[0];this.descEl=g(this.curLi,".voteDesc a")[0];this.urlEl=g(this.curLi,".voteUrl a")[0];if(b==="")b=this.CONST.DEFAULT_DESC_TEXT;if(c==="")c=this.CONST.DEFAULT_URL_TEXT;this.updateTxt(b,c)};F.prototype.updateTxt=function(a,b){if(a!==this.CONST.DEFAULT_DESC_TEXT||b!==this.CONST.DEFAULT_URL_TEXT){if(a===this.CONST.DEFAULT_DESC_TEXT)this.descEl.innerHTML=this.CONST.DEFAULT_DESC_TEXT;else{var c=UI.parent(this.descEl);c.innerHTML=UI.txTpl(this.optionTmpl,{css:"desc_tx",cont:a});UI.addClass(c,"desc");this.descEl=g(c,".desc_tx")[0]}if(b===this.CONST.DEFAULT_URL_TEXT)this.urlEl.innerHTML=this.CONST.DEFAULT_URL_TEXT;else{c=UI.parent(this.urlEl);c.innerHTML=UI.txTpl(this.optionTmpl,{css:"url_tx",cont:b});UI.addClass(c,"url");this.urlEl=g(c,".url_tx")[0]}UI.show(UI.parent(this.descEl));UI.show(UI.parent(this.urlEl));UI.hide(this.editEl)}else{this.descEl.innerHTML=this.CONST.DEFAULT_DESC_TEXT;this.urlEl.innerHTML=this.CONST.DEFAULT_URL_TEXT;UI.hide(UI.parent(this.descEl));UI.hide(UI.parent(this.urlEl));UI.show(this.editEl)}};F.prototype.check=function(){var a={desc:0,url:0},b=0;if(MI.string.length(this.descTi.value)>2*this.CONST.MAX_DESC)a.desc=-1;if(this.urlTi.value!==""){var c=this.urlTi.value.match(d._urlRegExp);if(c)b=c.length}if(b>this.CONST.MAX_URL)a.url=-1;return a};j.autoTxt2Pic=MI.user.fun.autoTxt2Pic;j.isDelegate=0;j.reset=N;j.getIsPicCut=function(){return T};j.setIsPicCut=function(a){T=a};j.show=function(a,b){d=a;if(!d.pvPicList){if(!d.statusTmpl)d.statusTmpl={};d.statusTmpl.picVoteTit=['<div class="sendPicTit tx_song"><h3>',_("图片投票"),"<span>（",_("可上传1-4张图片"),"）</span></h3></div>"].join("");d.statusTmpl.picVoteWrap='<ul class="larger_lst clear"><li class="addMoreBlock"><a href="#" class="btn_addMore_larger"><i class="b2_ic"></i><%=flashStr%><%=formStr%></a><p class="screenshot_lk"><a href="#" class="snap">截图</a><a href="#" class="soso">搜图</a></p></li></ul>';d.statusTmpl.picVoteItem='<li class="item" id="<%=picId%>" loaded="0"><div class="sendPicBlock"><span class="pic"><img src="<%=src%>" onload="<%=onload%>" style="position: relative;" size="<%=size%>" mode="0"></span><div class="o_000_6 <%=type%> optype"></div><a href="#x" class="btn_closed" style="display:none;"><i>×</i></a></div><div class="operate"><span class="editor voteEdit"><a href="#">编辑</a></span><span class="editor voteDesc" style="display:none;"><a href="#">添加图片描述</a></span><span class="editor voteUrl" style="display:none;"><a href="#">添加链接</a></span></div></li>';d.statusTmpl.picVoteOp='<a href="#" class="makeup_lk makeUpPic" title="美化"><i class="b2_ic ic_makeup"></i></a><span class="line_tx">|</span><a href="#" class="picCut_lk picCut" title="剪切"><i class="b2 b2_picCut"></i></a>';d.statusTmpl.picVoteEdit='<div class="addDesCha" style="display:none;"><span class="caret"><b class="caret_out"></b><b class="caret_in"></b></span><div class="addIntro clear"><input type="text" class="desc" value=""><span>不超过10个汉字</span></div><div class="addIntro clear"><input type="text" class="url" value=""><span>只能添加一个链接</span></div><div class="optintro clear"><p class="intro">描述和链接展示在图片幻灯页面，主页不可见</p><div class="opt"><label class="ok gb_btn gb_btn5"><input type="button" value="确定" class="t"></label><label class="no gb_btn gb_btn5"><input type="button" hidefocus="true" value="取消" class="t"></label></div></div></div>';d.statusTmpl.picVoteMore='<div class="control clear" style="display:none;"><div class="endtime voteAddTr"><span class="pr10">截止日期</span><select class="end_time_select"><option value="<%=n%>" selected="selected">无限制</option><option value="<%=d%>">一天</option><option value="<%=w%>">一周</option><option value="<%=m%>">一月</option><option value="<%=my%>">自定义</option></select><span class="myTime" style="display:none;"><input type="text" value="" class="date_ymd" id="js_calendar"><div class="calendar"><em class="ico_cale"></em><b class="a a_t a3"></b></div><select tabindex="8" id="js_hour" name=""><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>时<select tabindex="8" id="js_min" name=""><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option><option value="37">37</option><option value="38">38</option><option value="39">39</option><option value="40">40</option><option value="41">41</option><option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option><option value="46">46</option><option value="47">47</option><option value="48">48</option><option value="49">49</option><option value="50">50</option><option value="51">51</option><option value="52">52</option><option value="53">53</option><option value="54">54</option><option value="55">55</option><option value="56">56</option><option value="57">57</option><option value="58">58</option><option value="59">59</option></select> 分</span><span class="voteAddError error"></span></div><div class="listen" style="display:none;"><label><input type="checkbox" value="" checked=true><span>收听</span></label><a href="<%=picVLink%>" target="_blank">图片投票</a></div></div>';d.statusTmpl.picVoteClose='<a href="#" class="btn_closed closeBtn" title="退出图片投票"><i>×</i></a>';d.statusTmpl.picVoteWrap=UI.txTpl(d.statusTmpl.picVoteWrap,{flashStr:d.statusTmpl.flashUpLoad,formStr:d.statusTmpl.formUpload});var c=UI.html(d.statusTmpl.picVoteTit)[0];d.pvPicList=UI.html(d.statusTmpl.picVoteWrap)[0];B=UI.html(UI.txTpl(d.statusTmpl.picVoteMore,{picVLink:"http://t.qq.com/tupiantoupiao",n:aa,d:1,w:2,m:3,my:4}))[0];var f=UI.html(d.statusTmpl.picVoteClose)[0],e=UI.html(d.statusTmpl.picVoteEdit)[0];H=g(B,".end_time_select")[0];UI.append(c,d._sendStatusVote);UI.append(d.pvPicList,d._sendStatusVote);UI.append(e,d._sendStatusVote);UI.append(B,d._sendStatusVote);UI.append(f,d._sendStatusVote);I=new F(e);UI.delegate(sa,d._sendStatusVote);d._addFormPic(g(d.pvPicList,".sPicForm")[0],g(d.pvPicList,"input")[0]);d.dragPicSort(d.pvPicList,"item",function(){I.fixArrowPos()});window.onbeforeunload=function(){var a=j.getPicVote();a.votes.length===0&&(a="");if(d.autoSave)try{MI.S(la,UI.json2str(a))}catch(b){}window.onbeforeunload=null}}var s=function(){UI.show(d._sendStatusVote);UI.show(d._talkBoxStatus)};b&&s();MI.ajax({url:"http://p.t.qq.com/photovote/pvote/getattr",type:"get",success:function(a){a=MI.json(a);if(a.result===0){var c=g(B,".listen")[0];if(a.follow){UI.show(c);g(c,"input")[0].checked=true;ca=1}else{UI.hide(c);ca=0}na=a.share;if(a.guide&&!b){var f={callback:function(){s()}},e=function(){MI.ajax({url:"http://api.t.qq.com/asyn/userAttrSave.php",data:{t:330,v:1},type:"post"})};if(!ba){ba=UI.html('<div class="content"><h3 class="con_tit"></h3><div class="con_body"><img src="http://mat1.gtimg.com/www/mb/img/p2/picvote_d_pv.png" alt="图片投票流程解析"></div><div class="step_btn tx_yh"><a href="#x">知道了</a></div></div>')[0];UI.css("\t.D_votePic_1 .DWrap { padding:0!important; background: #fff!important; border: 0!important; border-radius: 5px; }\t.D_votePic_1 .DWrap::after { display: none!important; }\t.D_votePic_1 .DTitle { display: none; }\t.D_votePic_1 .tbSendMsg { border:0!important; }\t.D_votePic_1 a.DClose { width: 30px; height: 30px; top: 19px; right: 19px; background: url(http://mat1.gtimg.com/www/mb/img/p2/picvote_close.png) no-repeat; opacity: .5; filter: alpha(opacity=50); }\t.D_votePic_1 a.DClose:hover { opacity: 1; filter: alpha(opacity=100); }\t.D_votePic_1 .content{ padding: 31px 0 20px; }\t.D_votePic_1 .con_tit{ width: 416px; height: 61px; background: url(http://mat1.gtimg.com/www/mb/img/p2/picvote_d_tit.png) 0 0 no-repeat; margin: 0 auto; }\t.D_votePic_1 .con_body{ border: 1px solid #ddd; padding: 12px 38px 12px 30px; background: #ececec; margin-top: 19px; }\t.D_votePic_1 .con_body img{ display: block; width: 600px; height: 250px; margin: 0 auto; }\t.D_votePic_1 .step_btn{ margin-top: 19px; }\t.D_votePic_1 .step_btn a{ display: block; width: 134px; height: 41px; line-height:41px; color: #fff; text-align: center; font-size: 18px; background: #6196be; border-radius: 5px; margin: 0 auto; }\t.D_votePic_1 .step_btn a:hover{ text-decoration: none; opacity: .9; filter:alpha(opacity=90);}")}MI.dialog.show({bodyClass:"D_votePic_1",width:670,html:ba,start:function(){var a=g(MI.dialog._body,".content .step_btn a")[0];if(!a.onclick)a.onclick=function(){f.callback&&f.callback();MI.dialog.hide();e();d._boss("btnPicVoteGuideOk");return false}},closeEnd:function(){N();e();d._boss("btnPicVoteGuideClose")}})}else s()}else N()},fail:function(){N()}});da=UI.formatDate(new Date,"yyyy-MM-dd");d.maxPics=4;d.attachStatus=7;if(d.pvPicList){c=g(d.pvPicList,".addMoreBlock")[0];UI.C(c,"visibility","")}d.disablePuzzleAttach(true);d.guideTextValue&&setTimeout(function(){UI.removeClass(d._txt,"cNote");d._txt.value=""},250);v=v+"&utype=10"};j.showDraft=function(a){d=a;var b=MI.json(MI.S(la)||"[]");if(b.length!==0){j.show(a,true);d.pics=[];d._paths=[];UI.each(b.votes,function(a){d.pics.push(a.pic);d._paths.push(a.path);d.picsNum=d.pics.length;var b=d.push2PrevArea(1,{thumb:d.defaultThumb,isDraft:1});d.showPicPrev({code:0,picId:b,path:a.path,picSmall:a.pic+"/460"});d._pushPicIdMap(a.pic,b);I.set(l(b),a.desc,a.url)});H.value=b.endtime.type;if(b.endtime.type==4){a=g(B,".myTime")[0];l("js_calendar").value=b.endtime.date;l("js_hour").value=b.endtime.hour;l("js_min").value=b.endtime.min;UI.show(a)}UI.show(B)}else if(MI.S(ma)=="1"){j.show(a);MI.S(ma,"")}};j.showShare=function(a){if(na&&a.picVote&&MI.user.fun.messageShare){var b=[],a=a||{};UI.each(a.img,function(a){b.push(a.url+"/460")});var c=UI.text(UI.html("<div>"+a.content+"</div>")[0]),f={desc:"推荐@"+MI.user.name+"的微博",title:MI.user.name+" 的微博",summary:c,pics:b,url:"http://t.qq.com/p/t/"+a.id},e=["我在腾讯微博发起了一条图片投票，邀请你来投票：",MI.string.cut(c,76,"……"),"” - 原文地址:",f.url,"?pgv_ref=wbmsgShare"].join("");MI.app("module/TalkList.Share",function(b){b.init({id:a.id,shareObj:f,pmTxt:e,moreDom:'<label><input onclick="MI.NewTalkBox.prototype.picVote.remindShare(this);" type="checkbox" style="vertical-align:middle;margin-right:5px;"><span>下次不再提醒</span></label>',type:"picVote",picVote:1,author:{account:MI.user.account,name:MI.user.name}})})}};j.remindShare=function(a){U||(U=MI.ajax({url:"http://api.t.qq.com/asyn/userAttrSave.php",type:"post",data:{t:329,v:a.checked?1:0},success:function(){U=null},fail:function(){U=null}}));d._boss("btnPicVoteNoShare")};j.follow=function(){ca&&g(B,".listen input")[0].checked&&MI.ajax({url:MI.url.follow,data:{u:"tupiantoupiao",veriCode:"",lieuId:""},success:function(a){MI.json(a)}})};j.toggleOp=function(a){UI.each(g(d.pvPicList,".item .operate"),function(b){a?UI.show(b):UI.hide(b)})};j.getPicVote=function(a){var b={votes:[]};UI.each(g(d.pvPicList,".item"),function(c){var e=g(c,".operate .voteDesc a")[0].innerHTML,s=g(c,".operate .voteUrl a")[0].innerHTML,k=UI.indexOf(d.pics,d._getPicById(c.id)),p=d.pics[k],z=d._paths[k],k={};e==I.CONST.DEFAULT_DESC_TEXT&&(e="");s==I.CONST.DEFAULT_URL_TEXT&&(s="");k={pic:p,desc:e,url:s};if(a){c=g(c,".pic img")[0];k.cut=false;if(UI.height(c)!=UI.width(c))k.cut=true}else k.path=z;k.pic&&b.votes.push(k)});if(a){var c=+new Date;switch(parseInt(H.value,10)){case aa:c=0;break;case 1:c=c+864E5;break;case 2:c=c+6048E5;break;case 3:c=c+2592E6;break;case 4:c=l("js_calendar").value+" "+l("js_hour").value+":"+l("js_min").value;c=UI.parseDate(c,"yyyy-MM-dd hh:mm").getTime()}b.endtime=parseInt(c/1E3,10);b.votes.length===0&&(b=null)}else{b.endtime={type:H.value};if(H.value==4){b.endtime.date=l("js_calendar").value;b.endtime.hour=l("js_hour").value;b.endtime.min=l("js_min").value}}return b};j.addPic=function(a){var b,c;if(MI.Capture)MI.Capture.uploading=0;if(!d._cancelPicMap[a.info.picId])if(0===a.result){UI.show(B);a.info.image=a.info.image.replace(/\/\d{1,}$/g,"");b=a.info.image;if(!(d.maxPics<=d.picsNum)||a.info.makeup){if(a.info.makeup){c=UI.indexOf(d.pics,d._getPicById(a.info.picId));d.pics[c]=b;d._paths[c]=a.info.path}else{d.pics.push(b);d._paths.push(a.info.path)}d._pushPicIdMap(b,parseInt(a.info.picId,10));d.picsNum=d.pics.length;if(c=b.hasString("qpic.cn")){d.pic=b;b=b+"/460"}else d.sourcePic=b;d.showPicPrev({code:0,picId:a.info.picId,path:a.info.path,picSmall:b});ka();d._Time1s[a.info.picId]=+new Date}}else{d._Time1s[a.info.picId]=-1;d.showPicPrev({code:a.result,picId:a.info.picId,msg:a.msg})}};j.delPic=function(a){if(!d._isPicLoading(d._sendStatusVote)){if(a){var b=l(a);d._beforeDelPicById(a);UI.remove(b)}else{d.pics=[];d._paths=[]}d.picsNum=d.pics.length;if(d.picsNum===0){UI.hide(B);d.sourcePic="";d.pic="";MI.Capture&&MI.Capture.uploader&&MI.Capture.uploader.StopUpload();a=g(d._sendStatusVote,"ul .item");UI.each(a,function(a){UI.remove(a)})}else d.pic=d.sourcePic=d.pics[d.picsNum-1];d.dealPrevArea();d._showCursor();ka()}};j.delPicVote=function(){$()};j.isNowPicVote=function(a){return a.attachStatus==7};oa.prototype={isMumLoading:0,defaultThumb:"http://t2.qpic.cn/mblogpic/997d7f48ab991ecbc2fc/160",_Time0s:[],_Time1s:[],_picIdMap:{},_flashAnim:[],_cancelPicMap:{},_paths:[],_urlRegExp:pa,attachStatus:0,cutNum:14,simpleAttach:"insertFace atSome newTopic atWen schBrace picVote smoreFun".split(" "),disableIcoCss:"insertFunDisabled",mediaUp:"upPic_search upPic_merge upPic_url upVideo_url upVideo_camera upPic upMusic upVideo upVote".split(" "),_getPicById:function(a){var b="";UI.each(this._picIdMap,function(c,f){c==a&&(b=f)});return b=b.replace(/pic\d+:\/\//g,"")},_pushPicIdMap:function(a,b){var c=this;if(!c.random)c.random=MI.random();UI.each(c._picIdMap,function(f,e){parseInt(f,10)===parseInt(b,10)&&delete c._picIdMap[e];e==a&&(a="pic"+c.random++ +"://"+a)});c._picIdMap[a]=b},_addLinkEvent:function(){var a=this;UI.linkEvent.add("TalkBox.Face.tab",function(b){a._boss("btnFaceTab"+b)});UI.linkEvent.add("TalkBox.Face.subTab",function(b,c){a._boss("btnFaceSubTab_"+b+"_"+c)});UI.linkEvent.add("TalkBox.Face.insert",function(b){a._boss({name:"btnFaceInsert",sBak1:encodeURIComponent(b.type+"_"+b.title)})});UI.linkEvent.add("TalkBox.Face.close",function(){a._boss("btnFaceClose")});UI.linkEvent.add("TalkBox.LongWB.new",function(){a.addLongWB&&a._boss("btnLongWBAgain")});UI.linkEvent.add("TalkBox.LongWB.edit",function(){a._boss("btnEditLongWB")});UI.linkEvent.add("TalkBox.LongWB.del",function(){a._boss("btnDelLongWB")});UI.linkEvent.add("TalkBox.LongWB.prevArea",function(){a.dealPrevArea()});UI.linkEvent.add("TalkBox.Video.add",function(a){a.url&&MI.S("draft_video_"+MI.Uin(),UI.json2str({url:a.url,title:a.title}))});UI.linkEvent.add("TalkBox.Video.del",function(){a._boss("btnDelVideo");MI.S("draft_video_"+MI.Uin(),"")});UI.linkEvent.add("TalkBox.Video.prevArea",function(){UI.A(a._videoAnchor,"title",_("腾讯视频、优酷、土豆、酷六可直接播放，也可自己上传"));a.dealPrevArea()});UI.linkEvent.add("TalkBox.Music.search",function(){a._boss("btnMusicSearch")});UI.linkEvent.add("TalkBox.Music.searchPage",function(){a._boss("btnMusicSearchPage")});UI.linkEvent.add("TalkBox.Music.favPage",function(){a._boss("btnMusicFavPage")});UI.linkEvent.add("TalkBox.Music.favSelect",function(){a._boss("btnMusicFavSelect")});UI.linkEvent.add("TalkBox.Music.prevArea",function(){UI.A(a._musicAnchor,"title",_("可按歌名、歌手名搜索并添加音乐"));a.dealPrevArea()});UI.linkEvent.add("TalkBox.Topic.new",function(){a._boss("btnTopic")});UI.linkEvent.add("TalkBox.Topic.autoShow",function(){a._boss("btnTxtTopic")});UI.linkEvent.add("TalkBox.Topic.item",function(){a._boss("btnTopicItem")});UI.linkEvent.add("TalkBox.Wen.new",function(){a._boss("btnAtWen")});UI.linkEvent.add("TalkBox.Vote.new",function(){a.vote&&a._boss("btnVoteAgain")});UI.linkEvent.add("TalkBox.Vote.edit",function(){a._boss("btnEditVote")});UI.linkEvent.add("TalkBox.Vote.del",function(){a._boss("btnDelVote")});UI.linkEvent.add("TalkBox.Vote.prevArea",function(){a.dealPrevArea()});UI.linkEvent.add("TalkBox.send",function(b){var c=b.content;a._boss({name:"sendMsgSucc",sBak1:b.id});if(c){var f=c.match(/<img[^>]*>/g);UI.each(f,function(c){if(!c.hasString("onclick")){var f=c.replace(/.*title='(.*)'.*/g,"$1");c.indexOf("k")!=-1&&(f=c.replace(/.*k='(.*)'.*/g,"$1")+"_"+f);a._boss({name:"sendFaceSucc",sBak1:encodeURIComponent(f),sBak2:b.type=="1"?"1":"0"})}});c.indexOf("#万能的微博#")!=-1&&c.indexOf("@问问")!=-1&&a._boss({name:"sendWenSucc",sBak1:b.id})}a.picVote.showShare(b);a.picVote.follow()})},_getPicList:function(){return this.attachStatus==7?this.pvPicList:this.prevList},_getSortPics:function(a){var b=[],c=this;UI.each(g(c._getPicList(),"li"),function(f){if(f.id){var e=c._getPicById(f.id);a?b.push(e.replace(/\/\d{1,4}$/g,"")):b.push({src:e,id:f.id})}});return b},checkSend:function(){var a={},b=this._sendStatusPics;a.picIds=[];if(this.parseUrl.enable&&this.urlParsePrev){var c=this.parseUrl.isEmpty();if(c==-1)a.msg=this.parseUrl.Tips.noTit;else if(c==-2)a.msg=this.parseUrl.Tips.noDesc;else if(c==-3)a.msg=this.parseUrl.Tips.none;c!==0?a.type=4:this.url2Rich=this.parseUrl.getParse();a.checkFun=function(){MI.alert(a.msg)}}if(this.attachStatus==7)b=this._sendStatusVote;if(g(b,".loader").length>0){UI.each(g(this._getPicList(),".sendPicBlock"),function(b){g(b,".loader").length>0&&a.picIds.push(UI.A(b,"id"))});a.msg=_("还有正在上传的图片，是否继续");a.type=1}if(g(b,".losed").length>0){a.msg=_("还有上传失败的图片，是否继续");a.type=2}if(g(b,".rotating").length>0){a.msg=_("还有正在旋转的图片，是否继续");a.type=3}if(this.attachStatus==7&&!this.picVote.getPicVote(1)){a.msg=_("尚未上传图片，确定发送广播？");a.type=4}return a},_beforeDelPicById:function(a){var a=l(a),a=g(a,".pic img")[0],b=UI.A(a,"rotateUrl"),b=b||a.src,b=b.replace(/\/\d{1,}$/g,""),a=UI.indexOf(this.pics,b);if(a!=-1){this.pics.splice(a,1);this._paths.splice(a,1);if(this.attachStatus!=7){MI.S("draft_pics_"+MI.Uin(),UI.json2str(this.pics));MI.S("draft_paths_"+MI.Uin(),UI.json2str(this._paths))}}},cancelPic:function(a){this._beforeDelPicById(a);UI.remove(l(a));this._cancelPicMap[a]=1;this.dealPrevArea();this.hideMedia();this._showCursor();if(MI.Capture)MI.Capture.uploading=0;if(MI.PhotoMultiUpload)MI.PhotoMultiUpload.picId=0;UI.removeClass(this._picAnchor,"disabled")},delPic:function(a){if(a){var b=l(a);this._beforeDelPicById(a);UI.remove(b)}else{this.pics=[];this._paths=[]}this.picsNum=this.pics.length;if(this.picsNum===0){this.pic=this.sourcePic="";if(this._txt.value==this.txtPic)this._txt.value="";if(this.txtSummary){this._txt.value=this._txt.value.replace(this.txtSummary,"");this.txtSummary=""}this.longTextModify=0;this.longText="";MI.Capture&&MI.Capture.uploader&&MI.Capture.uploader.StopUpload();this.countTxt();a=g(this._sendStatusPics,"ul .sendPicBlock");UI.each(a,function(a){UI.remove(a)});if(this.autoSave)try{MI.S("draft_pic_"+MI.Uin(),"");MI.S("draft_pics_"+MI.Uin(),"");MI.S("draft_paths_"+MI.Uin(),"")}catch(c){}this.delMedia(1)}else this.pic=this.sourcePic=this.pics[this.picsNum-1];UI.removeClass(this._picAnchor,"disabled");this.dealPrevArea();this._showCursor()},delAttach:function(a){var b;if(this.attach){if(a&&this.attach[a]){UI.remove(this.attach[a]);b=MI.json(MI.S("draft_attach_"+MI.Uin()));b[a]="";b=UI.json2str(b)}else{UI.each(this.attach,function(a){UI.remove(a)});b=""}MI.S("draft_attach_"+MI.Uin(),b)}this.dealPrevArea();UI.linkEvent("TalkBox.Attach.del",a)},makeUpPic:function(a){var b=[];UI.each(g(this._getPicList(),"li"),function(a){a.id&&b.push(a.id)});this.curPic=UI.indexOf(b,a);MI.MakeUpPic.build("http://upload.t.qq.com/asyn/updateGrabPic.php",this)},rotatePic:V,_showCursor:function(){var a=this._getPicList();a&&(this.picsNum>1?UI.addClass(a,"move"):UI.removeClass(a,"move"))},dragPicSort:function(a,b,c){var f=this,e=document;a.onmousedown=function(d){var k=UI.E(d),p=k.target,z=UI.children(p)[0];z&&(z.style&&z.style.cssText.toUpperCase().indexOf("FILTER")!=-1)&&(p=z);if(!(p.nodeName.toUpperCase()!="IMG"||f.picsNum<=1)){p.ondragstart=p.onselectstart=function(){return false};var h=k.x,o=UI.parents(p,b)[0],i=UI.getX(o)-UI.getX(a)-parseInt(UI.C(a,"paddingLeft").replace("px",""),10);UI.getX(o);for(var p=UI.width(o),y=[],l=g(a,"."+b),z=l.length,ta=parseInt(UI.C(o,"marginRight").replace("px",""),10),q=0;q<z;q++)y.push((p+ta)*q-p/2);var m=o.cloneNode(true),j=UI.html('<li class="'+b+' dragto" style="height:'+UI.height(o)+'px"></li>')[0],p=g(m,".pic img")[0];UI.A(m,"rel",UI.A(m,"id"));UI.A(m,"id","");p.onload=null;UI.hide(o);UI.before(j,o);m.style.cssText="margin-left:"+i+"px";UI.addClass(m,"draging");UI.append(m,a);if(UI.B.ie6)m.style.cssText="left:"+(i+0)+"px;top:0;";m.onselectstart=function(){return false};e.onmouseup=function(){o.releaseCapture?o.releaseCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP);UI.show(o);UI.remove(m);j&&UI.replace(o,j);UI.remove(j);e.onmouseup=e.onmousemove=e.ontouchmove=e.ontouchend=null;c&&c();f._boss("dragPicSort")};e.onmousemove=function(a){var a=UI.E(a),b=a.x-h+i,c;c=-1;for(var e=0;e<y.length-1;e++)if(b>y[e]&&b<y[e+1]){c=e;break}else if(b<=y[0]){c=0;break}else if(b>=y[y.length-1]){c=y.length-1;break}m.style.cssText="margin-left:"+b+"px";if(UI.B.ie6)m.style.cssText="left:"+(b+0)+"px;top:0;";if(c!=-1){b=l[c];a.x-h>0?UI.after(j,b):UI.before(j,b);a=f._getPicById(UI.A(m,"rel"));b=f.pics[c];UI.swap(f.pics,a,b);UI.swap(f._paths,a,b)}};k.prevent(d);o.releaseCapture?o.releaseCapture():window.captureEvents&&window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}};a.onselectstart=function(){return false}},dealPrevArea:function(){var a=g(this._sendStatusPics,"ul .sendPicBlock"),b=g(this._sendStatusBar,".sendStatusItem"),c=0;if(a.length===0){UI.hide(this._sendStatusPics);c++}if(b.length===0){UI.hide(this._sendStatusBar);c++}if(!this.urlParsePrev){UI.hide(this._sendStatusUrl);c++}if(this.attachStatus!=7){UI.hide(this._sendStatusVote);c++}c===4&&UI.hide(this._talkBoxStatus);this.parseUrl.enable&&(a.length===0&&b.length===0?UI.removeClass(this._sendStatusUrl,"sendStatusUrlLine"):UI.addClass(this._sendStatusUrl,"sendStatusUrlLine"))},disablePuzzleAttach:function(a){var b=this;MI.user.fun.autoTxt2Pic=a?0:b.picVote.autoTxt2Pic;UI.each(g(b._body,".sendList,.dropBox li,.text2PicBtn"),function(c){var f=false;UI.each(b.simpleAttach,function(a){if(UI.hasClass(c,a))return f=true});f||(a?UI.addClass(c,b.disableIcoCss):UI.removeClass(c,b.disableIcoCss))})},_capturePic:function(a){var b=this;MI.TalkBox.cur=b;MI.app("Capture",function(){if(MI.Capture&&MI.Capture.enable){MI.Capture.hasFile=MI.Capture.screen.IsClipBoardImage||MI.Capture.uploader.GetClipboardFiles();MI.Capture.upload=function(a){var b=MI.Capture.screen.IsClipBoardImage,c=MI.Capture.uploader.GetClipboardFiles(),d;if(b){d=MI.Capture.screen.SaveClipBoardBmpToFile(1);MI.Capture.fileName=_("截屏.jpg")}else if(c){d=c.split(" ")[0];MI.Capture.fileName=c.replace(d+" ","").split("\r")[0]}if(d){MI.Capture.uploader.StopUpload();MI.Capture.uploader.ClearFormItems();MI.Capture.uploader.URL="http://upload.t.qq.com/asyn/uploadpic.php?picId="+a+"&g_tk="+v;MI.Capture.uploader.AddFormItem("pic",1,0,d);MI.Capture.uploader.StartUpload()}MI.Capture.uploading=1};MI.Capture.screen.OnCaptureFinished=function(){var c="";a!=2&&(c=b.push2PrevArea(1,{thumb:b.defaultThumb}));UI.B.ie&&window.focus();MI.Capture.upload(c)};MI.Capture.screen.OnCaptureCanceled=function(){b.upPic&&b.hideUp(b.upPic)};if(!MI.Capture.uploading){b.upPic&&b.flyAwayUp(b.upPic);if(a!=1)setTimeout(function(){MI.Capture.screen.DoCapture()},100);else if(MI.Capture.hasFile){var c=b.push2PrevArea(1,{thumb:b.defaultThumb});c&&MI.Capture.upload(c)}}}else UI.B.ie>=11?MI.alert(_("腾讯微博截屏插件暂不支持当前浏览器")):MI.confirm({title:_("你还未安装腾讯微博截屏插件"),content:_("安装后，你就可以使用截屏功能"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}})})},_sosoPic:function(a,b){var c=this;c.upPic_search?c.upPic_search._open=a:c.newUploadCollection({name:"Pic_search",tab:[_("搜图")],cnt:'<div class="picDiv searchPic"><div class="p_sResult"></div></div>',className:"D4_searchPic",query:".picDiv",_open:a,buildEvent:function(a){c.overrides.SearchPic(c,c.upPic_search);c._searchPicBox=g(a._box,".searchPic")[0];MI.SearchPic.builded||MI.SearchPic.build(c)}});MI.SearchPic.show(b);c.upPic_search.show(0)},_delDraft:function(){if(MI.json(MI.S("draft_music_"+MI.Uin())).music&&this.delMusic){this.delMusic(1);MI.S("draft_music_"+MI.Uin(),"")}if(MI.json(MI.S("draft_video_"+MI.Uin())).url&&this.delVideo){this.delVideo(1);MI.S("draft_video_"+MI.Uin(),"")}},_addDraft:function(){var a=this,b={};a.bindMultiPic().bind();a.pics=MI.json(MI.S("draft_pics_"+MI.Uin())||"[]");a._paths=MI.json(MI.S("draft_paths_"+MI.Uin())||"[]");a.picsNum=a.pics.length;a._picAnchor=g(a._body,".uploadPic .txt")[0];UI.each(a.pics,function(c,f){var d=a.push2PrevArea(1,{thumb:a.defaultThumb,isDraft:1});b[f]=d;a.showPicPrev({code:0,picId:b[f],path:a._paths[f],picSmall:c+"/460"});a._pushPicIdMap(c,b[f])});var c=MI.json(MI.S("draft_music_"+MI.Uin()));if(c.music){if(!a._musicAnchor)a._musicAnchor=g(a._body,".uploadMusic .txt")[0];a.push2PrevArea(2,{that:a,music:c.music,type:c.type,shorturl:c.shorturl,isdraft:1})}c=MI.json(MI.S("draft_video_"+MI.Uin()));if(c.url){var f=c.title.replace(/\&amp;/g,"&").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&quot;/g,'"');if(!a._videoAnchor)a._videoAnchor=g(a._body,".uploadVideo .txt")[0];a.video=c.url;a.push2PrevArea(3,{title:f,name:MI.string.cut(MI.string.html(f),a.cutNum),url:"http://url.cn/"+c.url});g(a._videoPreview,".del")[0].onclick=function(b){UI.E(b).stop();a.delVideo(1);UI.linkEvent("TalkBox.Video.del");return false}}(c=MI.json(MI.S("draft_attach_"+MI.Uin())))&&UI.each(c,function(b){b.id&&a.push2PrevArea(6,b)});a.pics.length===0&&a.picVote.showDraft(a)},_addFormPic:function(a,b){if(a&&b){var c=this;a.reset();if(MI.user.fun.qbUpload){UI.A(a,"action","http://wbupload://t.qq.com/asyn/updateGrabPic.php?retType=1&cookiejs=MI.TalkBox.cur.qbUploadCookie&successjs=MI.TalkBox.cur.qbUploadAddPic&positionjs=MI.TalkBox.cur.qbUploadPosition&g_tk="+v);a.removeAttribute("target");b.onclick=function(){if(c.upPic){c.upPic.PicUpTime=+new Date;c.upPic.hide()}a.submit();MI.TalkBox.cur=c;MI.Bos("btnPic")}}b.onchange=function(){var b=this.value.toLowerCase();if(!/\.(png|jpg|jpeg|gif)$/.test(b)){MI.alert(_("仅支持jpg、jpeg、gif、png图片文件"));return false}if(c.upPic)c.upPic.PicUpTime=+new Date;b=c.push2PrevArea(1,{thumb:c.defaultThumb});c.upPic&&c.flyAwayUp(c.upPic);UI.A(a,"action","http://upload.t.qq.com/asyn/uploadpic.php?picId="+b+"&g_tk="+v);a.submit();MI.TalkBox.cur=c;MI.Bos("btnPic");c.attachStatus==7&&c._boss("btnAddPicVoteForm")}}},_addPic:function(a){var b,c,f,e,d,g;if(this.attachStatus==7)this.picVote.addPic(a);else{this.longTextModify=a.info&&a.info.longTextModify;if(this.upPic)f=this.upPic.PicUpTime;e=+new Date;if(MI.Capture)MI.Capture.uploading=0;if(!this._cancelPicMap[a.info.picId]){if(0===a.result){if(this.upPic&&1===this.upPic.flashCapture){MI.PhotoMultiUpload.captureImg(a.info.image+"/2000");UI.hide(MI.PhotoMultiUpload.loading);return}a.info.image=a.info.image.replace(/\/\d{1,}$/g,"");b=a.info.image;if(this.maxPics<=this.picsNum&&!a.info.makeup)return;if(a.info.makeup){c=UI.indexOf(this.pics,this._getPicById(a.info.picId));this.pics[c]=b;this._paths[c]=a.info.path}else{this.pics.push(b);this._paths.push(a.info.path)}this._pushPicIdMap(b,parseInt(a.info.picId,10));this.picsNum=this.pics.length;if(c=b.hasString("qpic.cn")){this.pic=b;b=b+"/460"}else this.sourcePic=b;this.showPicPrev({code:0,picId:a.info.picId,path:a.info.path,picSmall:b});this.guideTextRemove();if(this._txt.value===""){this._txt.value=this.txtPic;this.countTxt()}this.focus();this._Time1s[a.info.picId]=+new Date;if(this.autoSave&&a)try{MI.S("draft_pic_"+MI.Uin(),UI.json2str(a));MI.S("draft_pics_"+MI.Uin(),UI.json2str(this.pics));MI.S("draft_paths_"+MI.Uin(),UI.json2str(this._paths))}catch(p){}this.addMedia(1)}else{this._Time1s[a.info.picId]=-1;this.showPicPrev({code:a.result,picId:a.info.picId,msg:a.msg})}this.picWait(a);if(f){d=+new Date-f;setTimeout(function(){g=+new Date-f;MI.Speed("t_asyn_uploadpic",1,e,d,g)},0)}if(this.upPic)this.upPic.PicUpTime=null}}},_isPicLoading:function(a){return g(a,".loader").length>0?true:false},_closeMoreBox:function(a){this._moreBox&&!UI.hasClass(a,"disabled")&&UI.removeClass(this._moreBox,"sopen")},flashPrev:function(a){var b=this;MI.app("module/Animate",function(c){var f,e;if(a===1){f=b._talkBoxStatus;e=["talkBoxStatus_full","talkBoxStatus_notfull"]}else{f=b.$(".otherPrev"+a);e=["fadeBg","fadeNoBg"]}b._flashAnim[a]||(b._flashAnim[a]=new c(f,e,100));b._flashAnim[a].repeat(3)})},countTxtCall:function(){var a=this;if(a.parseUrl.enable&&!a.urlParsePrev){var b=a._txt.value.match(a._urlRegExp);if((b=a.parseUrl.getUrl(UI.unique(b)))&&b.length>0&&!a.urlAjax)a.urlAjax=MI.ajax({url:"http://api.t.qq.com/urltorich/urltorich.php",type:"post",data:{url:b.join(" ")},success:function(b){b=MI.json(b);b.result===0?a.parseUrl.parse(b.info,a):a.urlAjax=null}})}},parseUrl:u,picVote:j,newEvents:{".picVote .txt":function(a,b){b._picVoteAnchor=this;b.hideAllUp();if(b.hasMedia()){b._boss("showGiveUp");MI.confirm({title:_("确定放弃已上传内容？"),content:"",confirmTxt:_("确定"),confirm:function(){MI.dialog.hide();b.delMedia();b._txt.value="";b.picVote.show(b);b._boss("btnGiveUpOK")},cancelTxt:_("取消"),cancel:function(){b._boss("btnGiveUpNo")}})}else b.picVote.show(b);b._boss("btnPicVote");a.prevent()}},picEvents:{".localPic":function(a,b,c){c._boss("btnLocalPic")},".mergePic":function(a,b,c){var f=['<div class="picDiv multiPic"><p class="c_tx5">',_("将多张图片拼接成1张（最多9张，按住Ctrl键选中，拖动图片可调整顺序）"),'</p><div class="flashWrap"></div><div class="clear">\t<p class="left" style="padding:5px 0 0 0"><a href="http://app.t.qq.com/app/intro/170278?via=170278_WB.TQQ.ADDTWEET" boss="btnPicCamera360" class="camera360 c_tx5" target="_blank">\t<i class="ico_camera360"></i>\t<span>Powered by Camera360 [',_("相机"),'360]</span></a><a class="ulink capture" style="display:none;" href="#">',_("直接截屏上传"),'</a>\t</p>\t<p class="right"><span class="error"></span><label class="gb_btn gb_btn1">\t<button type="button" class="t btnSend">',_("上传"),'</button></label><label class="gb_btn gb_btn5">\t<button type="button" class="t btnCancel">',_("取消"),'</button></label>\t</p></div><div class="maskLoading"></div>\t</div>'].join("");a.prevent();b.hide();c.upPic_merge||c.newUploadCollection({name:"Pic_merge",tab:[_("拼图模式")],cnt:f,className:"D4_collectPics",query:".picDiv",_open:c._picAnchor,buildEvent:function(a){MI.PhotoMultiUpload.build(a._div[0],"http://upload.t.qq.com/asyn/updateGrabPic.php?g_tk="+v);c.overrides.MergePic(c)}});c.upPic_merge.show(0);window._flash_resizeFlashHeight&&MI.PhotoMultiUpload&&window._flash_resizeFlashHeight(MI.PhotoMultiUpload.height);c._boss("btnMergePic")},".searchPic":function(a,b,c){a.prevent();b.hide();c._sosoPic(c._picAnchor);c._boss("btnSearchPic")},".snapPic":function(a,b,c){c._capturePic();a.prevent();c._boss("btnSnapPic")},".urlPic":function(a,b,c){a.prevent();a=['<div class="picDiv urlPic"><p>',_("粘贴图片地址"),'<span class="c_tx5">(',_("可在广播中直接显示图片"),')</span></p><form method="get" class="sourcepicFrom" name="sourcepicFrom">\t<div class="urlPicForm clear"><span class="form_item"><input type="text" class="inputTxt"></span><span class="form_item"><label class="gb_btn gb_btn1"><input type="button" class="t urlPicBtn" value=',_("上传"),'></label></span><p class="error" style="display:none">',_("图片地址不能为空，请在输入框粘贴或输入"),"</p>\t</div></form>\t</div>"].join("");b.hide();c.upPic_url||c.newUploadCollection({name:"Pic_url",tab:[_("链接")],cnt:a,className:"D4_urlPic",query:".picDiv",_open:c._picAnchor,buildEvent:function(a){var b=g(a._box,".urlPicBtn")[0],d=g(a._box,".sourcepicFrom")[0],k=g(a._box,".inputTxt")[0],p=g(a._box,".error")[0];a.resetUrlPic=function(){UI.hide(p);k.value="";p.innerHTML="";b.disabled=false};b.onclick=d.onsubmit=function(){var a=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","i"),f=[_("你输入的图片链接已提交，请等待"),_("图片地址不能为空，请在输入框粘贴或输入"),_("你输入的图片地址不是正确的URL格式，请重新输入")],d=UI.trim(k.value),g;if(a.test(d)){b.disabled=true;p.innerHTML=f[0];UI.show(p);c.flyAwayUp(c.upPic_url);g||(g=c.push2PrevArea(1,{thumb:c.defaultThumb}));MI.ajax({url:"http://upload.t.qq.com/old/uploadextpic.php",type:"get",data:"sourcepic="+encodeURIComponent(d),success:function(a){a=MI.json(a);a.info=a.info||{};c._addPic({result:a.result,msg:a.msg,info:{image:a.info.image,path:a.info.path||"",picId:g}});c.hideUp(c.upPic_url);g=0;if(a.result!==0)b.disabled=false;p.innerHTML=a.msg}})}else{k.focus();p.innerHTML=!d?f[1]:f[2];UI.show(p)}return false}},hideEvent:function(a){a.resetUrlPic&&a.resetUrlPic()}});c.upPic_url.show(0);c._boss("btnUrlPic")}},videoEvents:{".localVideo":function(a,b,c){a.prevent();c._boss("btnLocalVideo");b.hide();var a="http://p.t.qq.com/uploadvideo.php",b=(window.screen.availHeight-30-259)/2,f=(window.screen.availWidth-10-594)/2;c.data&&c.data.wqid&&(a=a+"?qid="+c.data.wqid+"&zone="+c.data.cflag);window.open(a,"wbVideo","height=259,width=594,top="+b+",left="+f+",scrollbars=yes,resizable=yes")},".urlVideo":function(a,b,c){a.prevent();c._boss("btnUrlVideo");a=['<div class="D4_video_content D4_video_online"><form method="get" class="videoUploadFrom" id="videoUploadFrom" name="videoUploadFrom"><div class="D4_sform D4_sform_vUrl clear">\t<p>',_("粘贴视频播放页地址"),'<span class="c_tx5">(',_("支持腾讯视频、优酷、土豆、酷六"),')</span></p>\t<span class="item"><input type="text" class="inputTxt"></span>\t<span class="item"><label class="gb_btn gb_btn1"><input type="button" value="',_("确定"),'" class="t"></label></span>\t<p class="cError" style="display: none; "><a href="#" class="vNormalBtn"></a></p>\t</form></div></div>'].join("");b.hide();c.upVideo_url||c.newUploadCollection({name:"Video_url",tab:[_("在线视频")],cnt:a,className:"D4_video",_open:c._videoAnchor,buildEvent:function(a){a._videoForm=g(a._box,".videoUploadFrom")[0];a._videoTxt=g(a._box,".inputTxt")[0];a._videoBtn=g(a._box,".gb_btn1")[0];a._videoError=g(a._box,".cError")[0];a._errMsg=[_("请先登录再进行操作"),_("稍等一下，喝杯茶，转贴的视频正在来的路上"),_("转贴的视频丢在路上了，再试一次？"),_("暂不支持该视频地址，")+'<a href="#" class="vNormalBtn">'+_("作为普通链接显示")+"</a>"];a._videoForm.onsubmit=a._videoBtn.onclick=function(){c._boss("btnUrlVideoBtn");if(!UI.trim(a._videoTxt.value)){a._videoTxt.focus();return false}c.getVideo(UI.trim(a._videoTxt.value));a._videoBtn.disabled=true;return false}}});c.upVideo_url.show(0)},".cameraVideo":function(a,b,c){a.prevent();c._boss("btnCameraVideo");b.hide();c.upVideo_camera||c.newUploadCollection({name:"Video_camera",tab:[_("拍摄视频")],cnt:'<div class="D4_video_content D4_video_camera videoDiv"><div class="flashWrap"></div><div class="maskLoading"></div></div>',className:"D4_video",query:".videoDiv",_open:c._videoAnchor,buildEvent:function(a){MI.VideoRecord.build(a._div[0]);MI.TalkBox.cur=c},hideEvent:function(){MI.VideoRecord.clear()}});c.upVideo_camera.show(0)}},addProxyEvent:function(a,b,c){var f=this,e;if(!e){e=[];UI.each(a,function(a,b){e.push(b)})}UI.proxyEvent(b,"click",function(b){return function(e){a[b]&&a[b].call(this,e,c,f)}},e)},overrides:{TalkBox:function(a){UI.css(".talkBox .focus .D3{top:auto;}");setTimeout(function(){MI.app("module/Animate",function(){})},0);a._sendStatus=a.$(".talkBoxStatus");a._talkBoxStatus=a.$(".talkBoxStatus");a._sendStatusBar=a.$(".sendStatusBar");a._sendStatusPics=a.$(".sendStatusPics");a._sendStatusUrl=a.$(".sendStatusUrl");a._sendStatusVote=a.$(".sendStatusPicVote");a.statusTmpl={picWrapPrevHtml:'<ul class="larger_lst clear prevList" style="">\t<li class="addMoreBlock"><a href="#" class="btn_addMore_larger"><i class="b2_ic"></i><%=flashStr%><%=formStr%></a><a href="#" class="screenshot_lk">截图上传</a></li></ul>',picItemPrevHtml:'<li class="sendPicBlock" id="<%=picId%>" loaded="0"><span class="pic"><img src="<%=src%>" onload="<%=onload%>" style="position: relative;" size="<%=size%>"></span><div class="o_000_3 <%=type%> optype"></div><a href="#x" class="btn_closed" style="display:none;"><i>×</i></a>\t</li>',picItemLoadHtml:'<span class="m_plan_bar"><b class="m_plan_per" style="width:<%=percent%>;"></b></span>',picItemLosedHtml:'<span class="ui_ico_s"><i class="ui_warnico"></i><span>上传失败</span></span>',picItemOpHtml:'<a href="#" class="makeup_lk makeUpPic" title="美化"><i class="b2_ic ic_makeup"></i>\t</a>\t<span class="line_tx">|</span>\t<a href="#" class="rotateR_lk rotatePic" title="右转"><i class="b2_ic ic_rotateR"></i>\t</a>',errorTipsHtml:'<div class="errorInfo error" style="display:none;">己添加<%=num%>张图片，无法继续添加</div>'};var b=MI.Flash.getVersion(),c=MI.user.fun.qbUpload?' type="button" value="&nbsp;" ':' type="file" size="3"',f="imageUpload_"+MI.random(),e=b?'<span class="flashMask">'+MI.Flash.getObject(null,MI.swf.MultiPicBtn+(UI.B.ie?"?r="+Math.random():""),"100%","100%","addBtnSwf2")+"</span>":"",d=['<form target="',f,'" method="post" enctype="multipart/form-data" class="sPicForm" action="http://upload.t.qq.com/asyn/uploadpic.php?g_tk=',v,'"><input hidefocus type="file" tabindex="3" name="pic"',c,' title="',UI.B.ie?"双击":"",_("添加图片,支持jpg、jpeg、gif、png格式，文件小于5M"),'" tabindex="3" class="input_file"',b?' style="position:absolute;left:-9999px;top:-9999px;"':"","></form>"].join(""),d=d+['<iframe id="',f,'" name="',f,'" src="about:blank" style="display:none"></iframe>'].join("");a.statusTmpl.flashUpLoad=e;a.statusTmpl.formUpload=d;a.statusTmpl.picWrapPrevHtml=UI.txTpl(a.statusTmpl.picWrapPrevHtml,{flashStr:e,formStr:d});f=UI.clone(a.events);f[".uploadPic .txt"]=function(a,e){e.pics&&e.pics.length>0&&e._boss("btnPicAgain");if(a.target.nodeName!="INPUT"){a.prevent();e._picAnchor=this;e._pic=UI.parent(this);e.curLongTextSource=e.longTextSource;if(!MI.user.fun.nanoMood){e.hideUp(e.upPic);e.addEvented||e.addEvent();if(!e.upPic){e.addBtnSwf1="addBtnSwf1";e.picUploadBuild=function(){var a=[_("图片上传")],f="imageUpload_"+MI.random(),d='<a href="#" class="d4_upBlock d4_upBlock_local localPic"><i class="d4_upic"></i><span class="text">上传图片</span>';b&&!UI.B.esobi&&(d=d+('<span class="flashMask" style="">'+MI.Flash.getObject(null,MI.swf.MultiPicBtn+(UI.B.ie6?"?r="+Math.random():""),"100%","100%",e.addBtnSwf1)+"</span>"));d=d+['<form target="',f,'" method="post" enctype="multipart/form-data" class="sPicForm" action="http://upload.t.qq.com/asyn/uploadpic.php?g_tk=',v,'"><input hidefocus type="file" tabindex="3" name="pic"',c,' title="',UI.B.ie?"双击":"",_("添加图片,支持jpg、jpeg、gif、png格式，文件小于5M"),'" tabindex="3" class="input_file"',b&&!UI.B.esobi?' style="position:absolute;left:-9999px;top:-9999px;"':"","></form>"].join("");d=d+['<iframe id="',f,'" name="',f,'" src="about:blank" style="display:none"></iframe>'].join("");if(UI.B.os6)MI.user.fun.qbUpload=0;e.newUploadCollection({name:"Pic",tab:a,cnt:UI.txTpl('<ul class="D4_picCenter_lst clear"><li class="item_local"><%=localStr%></li><li class="item_cut">\t<a href="#" class="d4_upBlock d4_upBlock_cut snapPic"><i class="d4_upic"></i><span class="text">截图</span>\t</a></li>\t</ul>',{localStr:d+"</a>"}),className:"D4_picCenter",_open:e._picAnchor,buildEvent:function(a){a._picForm=g(a._box,".sPicForm")[0];a._picBtn=g(a._picForm,"input")[0];e.addProxyEvent(e.picEvents,a._box,a);e.bindMultiPic().bind();e._addFormPic(a._picForm,a._picBtn)},tabEvent:function(a,b){if(b===0)try{a._picBtn.focus()}catch(c){}}})};if(!MI.user.fun.qbUpload&&UI.hasClass(document.body,"ipad")&&!UI.B.os6){UI.B.ipad?alert(_("此浏览器暂不支持图片上传，请到App Store下载并安装腾讯微博免费客户端。")):alert(_("此浏览器暂不支持图片上传，建议您使用QQ浏览器。"));MI.Bos("btnPicDisable");return false}e.picUploadBuild()}e.upPic.show(0)}}};f[".uploadMusic .txt"]=function(a,b){b.music&&b._boss("btnMusicAgain");a.prevent();if(!b.upMusic){b._music=this.parentNode;b._musicAnchor=this;var c='<div class="D4_music_content D4_music_search rSearch"></div>\t  <div class="D4_music_content D4_music_collect rFav hideDcnt"></div>\t  <%if(record){%><div class="D4_music_content D4_music_record recordBox hideDcnt"><%=flash%></div><%}%>\t  <%if(local){%><div class="D4_music_content D4_music_upLocal recordUploadMusic hideDcnt"><a class="btnUploadMusic btn_upLocal" href="javascript:void(0);"><i class="b2_ic"></i><span class="text">'+_("从电脑上传音乐")+"</span></a>\t  </div><%}%>";b.musicUploadBuild=function(){if(!b.upMusic){var a=!MI.user.fun.newMusicBox?[_("上传音乐"),_("音乐收藏")]:[_("分享歌曲"),_("分享歌单")],e,f=false,d=false;if(window.MILang!="en_US"&&MI.user.fun.audioRecord){a.push(b.recordTabName||_("我要录音"));e=MI.Flash&&MI.Flash.getVersion()<9?MI.Flash.updateTip(9):'<div class="flashWrap">'+MI.Flash.getObject(null,MI.swf.MusicRecord2,550,160,"musicRecord")+"</div>";f=true}if(MI.user.fun.audioUpload){a.push(_("本地上传"));d=true}b.newUploadCollection({name:"Music",tab:a,cnt:UI.txTpl(c,{record:f,flash:e,local:d}),query:".D4_music_content",className:"D4_music",_open:b._musicAnchor,buildEvent:function(a){MI.Music?MI.Music.show():MI.app("Music",function(){b.overrides.Music(b);MI.Music.build(b);MI.Music.show()});MI.app("Music",function(){a._audioUpload=g(a._box,".btnUploadMusic")[0];if(a._audioUpload)a._audioUpload.onclick=function(){a.hide();b.audioUpload();return false}})},showEvent:function(){MI.Music&&MI.Music.talkBoxList&&UI.each(MI.Music.talkBoxList,function(a){a==b?MI.Music.talkBox=b:a.upMusic.hide()})},hideEvent:function(a){clearTimeout(b.delayMusicTime);if(f)a._div[2].innerHTML="";MI.Music&&MI.Music.stop();b._boss("btnMusicClose")},tabEvent:function(a,c){if(2===c&&f)a._div[c].innerHTML=e;b._boss("btnMusicTab"+c)}})}};window.getMicRecUploadResult=function(a,c,e){if(a==="0"){UI.A(b.upMusic._tab[2],"music","0,"+c+","+MI.user.account+","+_("录音"));MI.Music.addPreview(b.upMusic._tab[2],"",1,e);b.upMusic.hide();b.music.songtype=3;b.music.shorturl=e;b.txtMusic=_("来，听听我的声音。")+" http://url.cn/"+e+" ";b._txt.value=b._txt.value!=b.txtMusic?b._txt.value+b.txtMusic:b.txtMusic;b.countTxt();b.focus()}};window.getRecDuration=function(){var a=[180,120,170,15];MI.TalkBox.prototype.data.cflag==2&&(a=[180,120,170,17]);return a};window.getToken=function(){return v};b.musicUploadBuild()}b.upMusic.show(0);b._closeMoreBox(b._musicAnchor)};f[".uploadVideo .txt"]=function(a,b){b.video&&b._boss("btnVideoAgain");b._videoAnchor=this;if(!b.upVideo){b._video=this;b.videoUploadBuild=function(){b.newUploadCollection({name:"Video",tab:[_("视频上传")],cnt:'<ul class="D4_videoCenter_lst clear">\t<li class="item_local"><a href="#" class="d4_upBlock d4_upBlock_local localVideo"><i class="d4_upic"></i><span class="text">本地上传</span></a>\t</li>\t<li class="item_url"><a href="#" class="d4_upBlock d4_upBlock_url urlVideo"><i class="d4_upic"></i><span class="text">在线视频</span></a>\t</li></ul>',className:"D4_videoCenter",_open:b._video,buildEvent:function(a){b.addProxyEvent(b.videoEvents,a._box,a)},showEvent:function(a){UI.hide(a._videoError)},hideEvent:function(){clearTimeout(b.delayVideoTime);b._boss("btnVideoClose")}})};b.videoUploadBuild()}b.upVideo.show(0);b._closeMoreBox(b._videoAnchor);a.prevent()};a.events=UI.extend(f,a.newEvents);var k=function(){a.sending||a.countTxt()};a._body.onkeyup=function(b){b=UI.E(b);if(!a.sending){var c=UI.E(void 0);clearTimeout(a.delay.count);c.target==a._txt&&a.guideTextRemove();a.delay.count=setTimeout(k,75)}if((b.ctrl&&b.key==86||a.isCtrlV)&&!a.type){MI.TalkBox.cur=a;if((c=a._pic||g(a._body,".uploadPic .txt")[0])&&b.target==a._txt&&a.tmpTxt==a._txt.value){UI.fireEvent(c,"click");a.upPic&&a.hideUp(a.upPic);a._capturePic(1)}a.isCtrlV=0}}},MergePic:function(a){var b=MI.PhotoMultiUpload;b.height=165;if(b.sendBtn)b.sendBtn.onclick=function(){a.flyAwayUp(a.upPic_merge,1);setTimeout(function(){window.scrollTo(0,0)},100);if(!b.picId)b.picId=a.push2PrevArea(1,{thumb:a.defaultThumb});b.upload()};if(b.cancelBtn)b.cancelBtn.onclick=function(){b.clear();setTimeout(function(){window.scrollTo(0,0)},100);a.hideUp(a.upPic_merge,1)};b.uploadCall=function(c){UI.hide(b.loading);c=MI.json(c);c.info=c.info||{};b.clear();a.upPic.flashCapture=0;a._addPic({result:c.result,msg:c.msg,info:{image:c.info.image,path:c.info.path,host:c.info.host,fileName:c.info.fileName||_("多图")+".jpg",picId:b.picId}});if(a.sendReady){a._send();a.sendReady=0}b.picId=0;a.hideUp(a.upPic_merge,1)};b.capture=function(){a.upPic.flashCapture=1;a._capturePic(2);a._boss("btnMergeSnap")}},SearchPic:function(a,b){MI.SearchPic.defBindEvent=function(c){c.onclick=function(c){c=UI.E(c);if(c.target.nodeName.toUpperCase()=="IMG"){var e;a.flyAwayUp(b);e||(e=a.push2PrevArea(1,{thumb:a.defaultThumb}));MI.ajax({url:"http://upload.t.qq.com/old/uploadextpic.php",type:"get",data:"sourcepic="+encodeURIComponent(UI.parent(c.target).href),success:function(c){c=MI.json(c);c.info=c.info||{};a._addPic({result:c.result,msg:c.msg,info:{image:c.info.image,path:c.info.path||"",picId:e}});e=0;a.hideUp(b)}});window.__sosostat&&window.__sosostat.prget&&window.__sosostat.prget(document.location.href,"t.2.2."+c.target.id,0,"bq_app")}c.prevent();c.stop()}}},Music:function(a){MI.Music.tmpl={listAll:'<div class="D4_music_rst">\t<%if(retcode == 0){%><%if(list.length > 0){%>\t<div class="m_total clear total_bar"><div class="left"><span class="c_tx5">'+_("搜索结果({0}首)","<%=totalnum%>")+'</span></div>\t</div>\t<table class="D4_music_lst m_list" width="100%"><tbody><%for(var i=0,n=list.length;i<n;i++){%>\t<%var musicid = list[i].musicid,songname = MI.string.entityReplace(list[i].songname),singername = MI.string.entityReplace(list[i].singername),songurl = list[i].songurl,str = MI.Music.cut(MI.Music.getHTML(songname ),MI.Music.getHTML(singername));str[0] = MI.string.cut(songname, 24);if(str[0] != songname){\tMI.Bos({name:"cutMusicItemString", id:1192});}%>\t<tr class="item"><td class="c1 song" music="<%=musicid%>,<%=songurl%>,<%=singername%>,<%=songname%>"><a href="#" class="song_tx" title="<%=songname%> - <%=singername%>"><%=str[0]%></a><span class="singer_tx"><%=str[1]%></span></td><td class="c2"><a href="#" class="btn_play_link" title="'+_("试听音乐")+'"><i class="b2_ic btn_play" id="play_<%=musicid%>"></i></a></td><td class="c3"><a href="#" class="b2_ic ic_addMusic btn_add" title="'+_("添加音乐")+'"></a></td></tr><%}%></tbody>\t</table><%}else{%>\t<div class="m_noResult"><p>'+_('对不起，未找到"{0}"的相关歌曲。',"<%=MI.string.html(_Key)%>")+"</p><p>"+_("请检查关键词是否正确，或更换其他关键字搜索。")+'</p></div><%}%>\t<%}else{%><div class="m_noResult"><h4>'+_("系统繁忙，请稍后再试")+"</h4></div>\t<%}%>\t</div>",listAll2:'<div class="D4_music_rst">\t<%if(code == 0){%><div class="m_total total_bar clear">\t<div class="left"<%for(var i=0,n=DirList.length;i<n;i++){if(SongDirID == DirList[i].DirID){%> title="<%=DirList[i].DirName%>"><span class="c_tx5"><%=MI.string.cut(DirList[i].DirName,32)%><%;break;}}%>('+_("{0}首","<%=SongList.length%>")+')</span></div>\t<div class="right"><%if(DirList.length > 0){%><select>\t<%for(var i=0,n=DirList.length;i<n;i++){%>\t<option value="<%=DirList[i].DirID%>" DirName="<%=DirList[i].DirName%>" DirShow="<%=DirList[i].DirShow%>" DirTime="<%=DirList[i].DirTime%>" <%if(SongDirID == DirList[i].DirID){%>selected="true"<%}%> title="<%=DirList[i].DirName%>"><%=MI.string.cut(DirList[i].DirName, 32)%></option>\t<%}%></select><%}%>\t</div></div><%if(SongList.length > 0){%><table class="D4_music_lst m_list" width="100%">\t<tbody>\t<%for(var i=(curnum*curpage),n=(curnum*curpage+MI.Music.PageNum) > SongList.length ? SongList.length : (curnum*curpage+MI.Music.PageNum);i<n;i++){%><%var musicid = SongList[i].id,\tsongname = MI.string.entityReplace(SongList[i].songname),\tsingername = MI.string.entityReplace(SongList[i].singername),\tsongurl = SongList[i].url,\ttype = SongList[i].type,\tstr = MI.Music.cut(MI.Music.getHTML(songname ),MI.Music.getHTML(singername));\tstr[0] = MI.string.cut(songname, 24);\tif(str[0] != songname){MI.Bos({name:"cutMusicItemString", id:1192});\t}\t%><%if(songurl){%><tr class="item"><td class="c1 song" music="<%=musicid%>,<%=songurl%>,<%=singername%>,<%=songname%>,<%=type%>"><a href="#" class="song_tx" title="<%=songname%> - <%=singername%>"><%=str[0]%></a><span class="singer_tx"><%=str[1]%></span></td><td class="c2"><a href="#" class="btn_play_link" title="'+_("试听音乐")+'"><i class="b2_ic btn_play" id="play_<%=musicid%>"></i></a></td><td class="c3"><a href="#" class="b2_ic ic_addMusic btn_add" title="'+_("添加音乐")+'"></a></td><%}%>\t<%}%>\t</tbody></table><%}else{%>\t<div class="m_noFav"><h4>'+_("您尚未在列表中收藏任何歌曲")+'</h4></div><%}%>\t<%}else{%><div class="m_noFav"><h4>'+_("系统繁忙，请稍后再试")+"</h4></div>\t<%}%></div>"};MI.Music.bindSongClickEvent=function(b,c){if(b){var f=this,c=c?c:"";UI.each(g(b,".m_list .item"),function(b){b.onclick=function(a){a=UI.E(a);if(!UI.hasClass(a.target,"btn_play_link")){f.addPreview(g(b,".song")[0],c);f.stop()}return false};var d=g(b,".btn_play")[0],k=g(b,".btn_play_link")[0];if(f.lastMusicId){f.lastMusic=l(f.lastMusicId);if(d.id===f.lastMusicId){UI.A(d,"play","1");UI.A(f.lastMusic,"title",_("试听音乐"));UI.removeClass(f.lastMusic,"loading");UI.removeClass(d,"btn_play");UI.addClass(d,"btn_pause")}}k.onclick=function(){UI.fireEvent(d,"click");return false};d.onclick=function(d){UI.E(d).stop();d=parseInt(UI.A(this,"play"),10);if(f.lastMusic){UI.A(f.lastMusic,"play","0");UI.A(f.lastMusic,"title",_("试听音乐"));UI.removeClass(f.lastMusic,"loading");UI.removeClass(f.lastMusic,"btn_pause");UI.addClass(f.lastMusic,"btn_play")}if(d)f.stop(this);else{UI.A(this,"play","1");UI.removeClass(this,"btn_play");UI.addClass(this,"btn_pause");UI.B.ie&&UI.B.ie>=11||UI.addClass(this,"loading");UI.A(this,"title",_("暂停播放"));f.lastMusic=this;f.lastMusicId=this.id;var d=UI.A(g(b,".song")[0],"music").split(","),s={};s.songName=d[3];s.songurl=d[1];s.singerName=d[2];s.songID=d[0];s.type=d[4]?d[4]:"";f.play(s,c);a._boss("btnMusicPlay")}return false}})}};MI.Music.addPreview=function(b,c,f,e){a.push2PrevArea(2,{that:this.talkBox,music:UI.A(b,"music"),type:f,shorturl:e});a._boss("btnMusicAdd")}}},newUploadCollection:function(a){var b=this,c=a.name,f=a.tab,e=a.cnt,d=a.query,k=a.className,h=a.buildEvent,l=a.tabEvent,j=a.showEvent,o=a.hideEvent,a=a._open,i=b["up"+c]={},y=['<div class="D4 <%=className%>" style="display:none"><span class="caret"><b class="caret_out"></b><b class="caret_in"></b></span><div class="D4_in">\t<div class="D4_hd clear"><%=tabTit%><span class="D4_hd_op"><a href="#x" class="btn_remove close" title="',_("关闭"),'">×</a></span>\t</div>\t<div class="D4_bd"><%=cnt%></div></div>\t</div>'].join(""),x="";if(f&&f.length==1)x=x+['<h3 class="D4_hd_tit">',f[0],"</h3>"].join("");else if(f&&f.length>1){var n="";UI.each(f,function(a){n=n+('<li><a href="#">'+a+"</a></li>")});x=x+['<ul class="D4_hd_tab">',n,"</ul>"].join("")}y=UI.txTpl(y,{className:k,tabTit:x,cnt:e});i.name=c;i._box=UI.html(y)[0];i._open=a;i._tab=g(i._box,".D4_hd_tab li");i._div=d?g(i._box,d):[];i._close=g(i._box,".D4_hd .close")[0];i._arrows=g(i._box,".caret")[0];UI.after(i._box,b.$(".insertFun"));i.switchTab=function(a){if(!UI.hasClass(this,"cur")){UI.each(i._div,function(b,c){if(a==c){UI.addClass(i._tab[c],"cur");UI.removeClass(i._div[c],"hideDcnt")}else{UI.removeClass(i._tab[c],"cur");UI.addClass(i._div[c],"hideDcnt")}});l&&MI.app("Base",function(){l(i,a)})}};i.hide=function(){if(!(i._box.style.display=="none"||i._box.style.left=="-9999px")){o&&o(i);UI.C(i._box,"visibility","");UI.C(i._box,"left","");UI.hide(i._box)}};i.show=function(a){for(var e=0,f=0;f<i._tab.length;f++)if(i._tab[f].style.display!="none"){e=f;break}MI.TalkBox.cur=b;if(i._box.style.display!="none")return false;b.hideMedia();if(UI.hasClass(i._open,"disabled")){var d;if(i.name==="Pic"){d=1;UI.flicker(b.errorTips,3E3)}else i.name==="Music"?d=2:i.name==="Video"&&(d=3);b.flashPrev(d);return false}i._box.style.display="block";j&&j(i);i.switchTab(a||e);i._open.blur();MI.Bos("btn"+c);i.setArrPos(i._open);return false};i.setArrPos=function(a){if(a){var b;(b=UI.closest(a,".moreBox"))&&(a=b);b=UI.getX(a)+UI.width(a)/2;var c=UI.getX(i._box)+UI.width(i._box);c<=b&&UI.C(i._box,"left",b+100-c+"px");b=i.arrPos||b-UI.getX(i._box);UI.text(a)||(b=b-7);i._arrows.style.left=b+"px";return b}};UI.each(i._tab,function(a,b){a.onclick=function(){i.switchTab(b);return false}});i._close.onclick=function(){b.longTextSource==b.curLongTextSource?b.longTextModify=0:b.longTextSource=b.curLongTextSource||0;i.hide();return false};h&&h(i)},hideAllUp:function(){var a=this;UI.each(a.mediaUp,function(b){a[b]&&a[b].hide&&a[b].hide()})},flyAwayUp:function(a,b){if(a){var c=a._box;c||(c=a);b?UI.C(c,"visibility","hidden"):UI.C(c,"left","-9999px")}},flyInUp:function(a,b){if(a){var c=a._box;c||(c=a);b?UI.C(c,"visibility",""):UI.C(c,"left","")}},hideUp:function(a,b){if(a){this.flyInUp(a,b);a.hide()}},push2PrevArea:function(a,b){function c(){var a=g(l(b.picId),".pic img")[0],c=UI.A(a,"size"),e=UI.A(a,"orign"),d=UI.A(a,"cut"),f=UI.A(a,"mode");if(a)UI.parent(a).innerHTML=['<img orign="',e,'" cut="',d,'" onload="MI.NewTalkBox.ImgLoad(this);" src="',b.thumb,'" style="position: relative;" size="',c,'" mode="',f,'">'].join("")}function f(){if(e.isMumLoading)e.showMumLoading(d.picId);else{if(!b.realProgress&&!b.isDraft){e.showLoadBar(d.picId);e._boss("fakeLoadingBar")}b.realProgress&&e.showLoadBar(d.picId,{loaded:0.01,total:1})}}var e=this,d={},b=b||{};e.attachStatus==7?a=7:UI.show(e._talkBoxStatus);if(1===a)if(UI.hasClass(e._picAnchor,"disabled")&&!b.picId)e.flashPrev(1);else{UI.show(e._sendStatusPics);d.src=b.thumb||"#";if(d.picId=b.picId)c();else{if(!e.prevList){e.prevList=UI.html(e.statusTmpl.picWrapPrevHtml)[0];UI.append(e.prevList,e._sendStatusPics);e._addFormPic(g(e.prevList,".sPicForm")[0],g(e.prevList,"input")[0]);e.dragPicSort(e.prevList,"sendPicBlock")}if(!e.errorTips){e.errorTips=UI.html(UI.txTpl(e.statusTmpl.errorTipsHtml,{num:e.maxPics}))[0];UI.append(e.errorTips,e._sendStatusPics)}var k=g(e.prevList,".addMoreBlock")[0],h=g(k,"a"),j=g(e.prevList,".sendPicBlock").length,n=function(a){if(a<4){UI.hasClass(e.prevList,"small_lst")&&e._boss("prevAreaZoomIn");UI.removeClass(e.prevList,"small_lst");UI.addClass(e.prevList,"larger_lst");UI.removeClass(h[0],"btn_addMore");UI.addClass(h[0],"btn_addMore_larger");h[1].innerHTML="截图上传";d.size=100}else{UI.hasClass(e.prevList,"larger_lst")&&e._boss("prevAreaZoomOut");UI.removeClass(e.prevList,"larger_lst");UI.addClass(e.prevList,"small_lst");UI.removeClass(h[0],"btn_addMore_larger");UI.addClass(h[0],"btn_addMore");h[1].innerHTML="截图";d.size=55}UI.each(g(e.prevList,".pic img"),function(a){if(UI.A(a,"size")!=d.size+""){UI.A(a,"size",d.size);MI.NewTalkBox.ImgLoad(a)}})};if(!e.random)e.random=MI.random();d.type="";d.picId=e.random++;d.onload="MI.NewTalkBox.ImgLoad(this);";n(j);var o=UI.html(UI.txTpl(e.statusTmpl.picItemPrevHtml,d))[0],i=g(o,".btn_closed")[0],y=g(o,".optype")[0];UI.before(o,k);e.dealPrevArea();o.onmouseover=function(){UI.show(i);UI.A(o,"loaded")=="1"&&UI.show(y)};o.onmouseout=function(){UI.hide(i);UI.A(o,"loaded")=="1"&&UI.hide(y)};i.onclick=function(){if(UI.A(o,"loaded")=="0"){e.cancelPic(d.picId);e._boss("btnCancelPic")}else{e.delPic(d.picId);e._boss("btnDelPic")}j=g(e.prevList,".sendPicBlock").length;n(j-1);clearTimeout(e.delay.blur);return false};if(!h[1].onclick)h[1].onclick=function(){e._capturePic();e._boss("btnSnapPic");return false};if(j==e.maxPics-1){UI.flicker(e.errorTips,3E3);UI.addClass(e._picAnchor,"disabled");e._boss("picsPrevAreaFull")}}f();return d.picId}else{var x,r;if(2===a){var q=b.music.split(","),m=b.that,t="draft_music_"+MI.Uin(),w=function(a){x=UI.txTpl('<div class="sendStatusItem"><span class="item <%=tipsClass%>"><i class="ic <%=icoClass%>" style="<%=icoCss%>"></i><a href="<%=prevUrl%>" target="_blank" class="name_lk" title="<%=title%>" boss="<%=boss%>"><%=name%></a><%=opDom%><a href="#x" class="btn_remove del" title="删除">×</a></span></div>',{icoClass:"ico_audio",icoCss:"",tipsClass:"otherPrev2",title:MI.string.html(q[3])+"-"+MI.string.html(q[2]),prevUrl:a,boss:"{name:'btnPrevMusic', id:1192}",name:MI.string.cut(MI.string.html(q[3]),e.cutNum),opDom:""});MI.string.cut(MI.string.html(q[3]),10)!=MI.string.html(q[3])&&e._boss("cutMusicString");m._musicPreview=UI.html(x)[0];e._flashAnim[2]=null;if(!MI.user.fun.newMusicBox)m.music={id:q[0],song:q[3],singer:q[2],songurl:q[1],shorturl:b.shorturl,songtype:q[4]&&q[4]%10==1?2:""};UI.append(m._musicPreview,e._sendStatusBar);e.dealPrevArea();UI.addClass(m._musicAnchor,"disabled");UI.A(m._musicAnchor,"title",_("音乐已存在，可删除后替换"));if(e.autoSave&&b)try{MI.S(t,UI.json2str({music:b.music,type:b.type,shorturl:b.shorturl}))}catch(c){}m._recordAnchor&&UI.addClass(m._recordAnchor,"disabled");r=g(m._musicPreview,".del")[0];r.onclick=function(){if(!m._musicAnchor)m._musicAnchor=g(m._body,".uploadMusic .txt")[0];m.delMusic(b.isdraft);e._boss("btnDelMusic");MI.S(t,"");return false};e.hideUp(e.upMusic);UI.show(e._sendStatusBar);e.addMedia(3)};MI.user.fun.nanoMood&&(m._mood&&!UI.hasClass(m._mood,"disabled"))&&UI.addClass(m._mood,"disabled");if(b.type==1){w(q[1]);return}MI.ajax({url:MI.url.musicPlayUrl,data:{musicID:q[0],musicSong:window.escape(q[3]),musicSinger:window.escape(q[2]),musicLocation:q[1]},success:function(a){var a=MI.json(a),c="",e="";if(a.result===0){c=a.url;e=" http://url.cn/"+c;w(e)}a=_(" #分享音乐#");b.type==3&&(a=_(" #分享歌单#"));m.guideTextRemove();m.music.shorturl=c;m.txtMusic=a+" #"+UI.trim(q[3].replace(/\&quot;/gi,'"'))+(q[2]?"-":"")+UI.trim(q[2].replace(/\&quot;/gi,'"'))+"#"+(b.type!=3?e:"")+" ";c=m._txt.value;if(!c||c&&!c.hasString(m.txtMusic)&&!b.isdraft)m._txt.value=m._txt.value+m.txtMusic;m.countTxt();m.focus()}})}else if(3===a){x=UI.txTpl('<div class="sendStatusItem"><span class="item <%=tipsClass%>"><i class="ic <%=icoClass%>" style="<%=icoCss%>"></i><a href="<%=prevUrl%>" target="_blank" class="name_lk" title="<%=title%>" boss="<%=boss%>"><%=name%></a><%=opDom%><a href="#x" class="btn_remove del" title="删除">×</a></span></div>',{icoClass:"ico_videos",icoCss:"",tipsClass:"otherPrev3",title:b.title,name:b.name,prevUrl:b.url,boss:"{name:'btnPrevVideo', id:1192}",opDom:""});e._videoPreview=UI.html(x)[0];e._flashAnim[3]=null;UI.append(e._videoPreview,e._sendStatusBar);e.dealPrevArea();UI.addClass(e._videoAnchor,"disabled");UI.A(e._videoAnchor,"title",_("视频已存在，可删除后替换"))}else if(4===a){x=UI.txTpl('<div class="sendStatusItem"><span class="item <%=tipsClass%>"><i class="ic <%=icoClass%>" style="<%=icoCss%>"></i><a href="<%=prevUrl%>" target="_blank" class="name_lk" title="<%=title%>" boss="<%=boss%>"><%=name%></a><%=opDom%><a href="#x" class="btn_remove del" title="删除">×</a></span></div>',{icoClass:"ic_longwb",icoCss:"",tipsClass:"",title:"预览",name:"长微博",prevUrl:b.url,boss:"{name:'btnPrevLongWB', id:1192}",opDom:'<a href="#" class="b2_ic ic_edit edit_link" title="修改">[修改]</a>'});if(!e._uploadLongWB)e._uploadLongWB=UI.html(x)[0];k=g(e._uploadLongWB,".name_lk")[0];UI.addClass(k,"preview_link");UI.append(e._uploadLongWB,e._sendStatusBar);e.dealPrevArea()}else if(5===a){x=UI.txTpl('<div class="sendStatusItem"><span class="item <%=tipsClass%>"><i class="ic <%=icoClass%>" style="<%=icoCss%>"></i><a href="<%=prevUrl%>" target="_blank" class="name_lk" title="<%=title%>" boss="<%=boss%>"><%=name%></a><%=opDom%><a href="#x" class="btn_remove del" title="删除">×</a></span></div>',{icoClass:"ico_aVote",icoCss:"",tipsClass:"",title:b.title,name:b.name,prevUrl:b.url,boss:"{name:'btnPrevVote', id:1192}",opDom:'<a href="#" class="b2_ic ic_edit edit_link" title="修改">[修改]</a>'});if(e._uploadVote){k=g(e._uploadVote,".name_lk")[0];UI.A(k,"title",b.title);UI.A(k,"href",b.url);k.innerHTML=b.name}else e._uploadVote=UI.html(x)[0];UI.append(e._uploadVote,e._sendStatusBar);e.dealPrevArea()}else if(6===a){x=UI.txTpl('<div class="sendStatusItem"><span class="item <%=tipsClass%>"><i class="ic <%=icoClass%>" style="<%=icoCss%>"></i><a href="<%=prevUrl%>" target="_blank" class="name_lk" title="<%=title%>" boss="<%=boss%>"><%=name%></a><%=opDom%><a href="#x" class="btn_remove del" title="删除">×</a></span></div>',{icoClass:b.icoClass||"",icoCss:b.icoCss||"",tipsClass:"",prevUrl:b.prevUrl,title:b.title||"",name:b.name||"",boss:b.boss||"",opDom:b.opDom||""});if(!e.attach)e.attach={};e.attach[b.id]||(e.attach[b.id]=UI.html(x)[0]);UI.append(e.attach[b.id],e._sendStatusBar);e.dealPrevArea();if(b.draft){k={};k[b.id]=b;MI.S("draft_attach_"+MI.Uin(),UI.json2str(k))}r=g(e.attach[b.id],".del")[0];r.onclick=function(){e.delAttach(b.id);return false};UI.linkEvent("TalkBox.Attach.add",b.id)}else if(7===a){d.src=b.thumb||"#";d.picId=b.picId;var u=g(e.pvPicList,".addMoreBlock")[0],v=g(e.pvPicList,".sendPicBlock").length;if(b.picId)c();else{if(v>=e.maxPics){e.flashPrev(1);return}if(!e.picVote.errorTips){e.picVote.errorTips=UI.html(UI.txTpl(e.statusTmpl.errorTipsHtml,{num:e.maxPics}))[0];UI.append(e.picVote.errorTips,e._sendStatusVote)}if(!e.random)e.random=MI.random();d.type="";d.picId=e.random++;d.onload="MI.NewTalkBox.ImgLoad(this);";d.size=100;k=UI.html(UI.txTpl(e.statusTmpl.picVoteItem,d))[0];UI.before(k,u);e.dealPrevArea();if(!e.picVote.isDelegate){UI.delegate({mouseover:{".item .sendPicBlock":function(a,b){var c=g(b,".btn_closed")[0],e=g(b,".optype")[0];UI.show(c);UI.A(UI.parent(b),"loaded")=="1"&&UI.show(e)}},mouseout:{".item .sendPicBlock":function(a,b){var c=g(b,".btn_closed")[0],e=g(b,".optype")[0];UI.hide(c);UI.A(UI.parent(b),"loaded")=="1"&&UI.hide(e)}},click:{".item .btn_closed":function(a,b){var c=UI.parents(b,"item")[0],d=UI.A(c,"id");UI.A(c,"loaded")=="0"?e.cancelPic(d):e.picVote.delPic(d);v=g(e.pvPicList,".sendPicBlock").length;v<e.maxPics&&e.flyInUp(u,UI.B.ie?0:1);clearTimeout(e.delay.blur);a.prevent()}}},e._sendStatusVote);e.picVote.isDelegate=1}if(v==e.maxPics-1){UI.flicker(e.picVote.errorTips,3E3);e.flyAwayUp(u,UI.B.ie?0:1);e._boss("showPicVoteFull")}else e.flyInUp(u,UI.B.ie?0:1)}f();return d.picId}2!==a&&UI.show(e._sendStatusBar)}},showMumLoading:function(){},showLoadBar:function(a,b){var c=this,d=[1E3,3E3,15E3],e={},h=l(a),h=g(h,".optype")[0];if(!UI.hasClass(h,"loader")){h.innerHTML=UI.txTpl(c.statusTmpl.picItemLoadHtml,{percent:"4%"});UI.removeClass(h,"op");UI.addClass(h,"loader");UI.removeClass(h,"o_000_6");UI.addClass(h,"o_000_3");UI.show(h)}var k=g(h,".m_plan_per")[0];c._Time0s[a]||(c._Time0s[a]=+new Date);var j=function(a){var b=+new Date,c={60:d[0],80:d[1],95:d[2]},g=[],h=false,j,l=function(){var a=+new Date-b,d=parseInt(k.style.width.replace("%",""),10),f=a/c[j],a=j-d;if(f<1){f=Math.sin(f*0.5*Math.PI);k.style.width=d+a*f+"%";window.requestAnimateFrame(l)}else{k.style.width=j+"%";if(g.length){j=g.shift();window.requestAnimateFrame(l);e["per"+j]=1}else h=false}};g.push(a);if(!h&&g.length){j=g.shift();window.requestAnimateFrame(l);e["per"+j]=1;h=true}},n=function(){if(c._Time1s[a])c._Time1s[a]!=-1&&j(100);else{var b=+new Date-c._Time0s[a];b<d[0]?e.per60||j(60):b>d[0]&&b<d[1]?e.per80||j(80):b>d[1]&&b<d[2]&&(e.per95||j(95));window.requestAnimateFrame(n)}};b?k.style.width=parseInt(b.loaded/b.total*100,10)+"%":window.requestAnimateFrame(n)},showPicPrev:function(a){var b=this,c=l(a.picId),d=g(c,".optype")[0],e=g(c,".pic img")[0];g(c,".pic");if(a.code===0){UI.A(c,"loaded","1");UI.A(e,"src",a.picSmall);UI.A(e,"cut")!="1"&&UI.A(e,"orign",a.picSmall.replace(/\/\d{1,}$/g,""));UI.removeClass(d,"loader");UI.addClass(d,"op");UI.removeClass(d,"o_000_3");UI.addClass(d,"o_000_6");if(b.attachStatus==7)d.innerHTML=b.statusTmpl.picVoteOp;else{d.innerHTML=b.statusTmpl.picItemOpHtml;b.rotatePic.reset();g(d,".makeUpPic")[0].onclick=function(){var e=g(c,".pic img")[0];UI.A(e,"rotateUrl");b.makeUpPic(a.picId);b._boss("btnMakeUpPic");return false};g(d,".rotatePic")[0].onclick=function(){var e=g(c,".pic img")[0].src;b.rotatePic.rotate(a.picId,a.path,e,b);b._boss("btnRotatePic");return false}}UI.hide(d);b._showCursor()}else{UI.A(c,"loaded","-1");UI.removeClass(d,"loader");UI.addClass(d,"losed");UI.removeClass(d,"o_000_3");UI.addClass(d,"o_000_6");UI.A(d,"title",a.msg);d.innerHTML=b.statusTmpl.picItemLosedHtml;b._boss("uploadPicError");a.code===-1004&&b._boss("uploadGifPicError")}},bindMultiPic:function(){var a=this;return new function(){var b={_jf_miBos:function(b){a._boss(b)},_jf_startUpload:function(b,d){a.flyAwayUp(a.upPic,UI.B.ie?0:1);d.thumb="data:image/jpeg;base64,"+d.thumb;if(UI.B.ie6)d.thumb=a.defaultThumb;if(d.picId){MI.MakeUpPic.flyAway();a._Time1s[d.picId]=null;a._Time0s[d.picId]=null}return a.push2PrevArea(1,d)},_jf_updateProgress:function(b,d,e){a.showLoadBar(b,{loaded:d,total:e})},_jf_onUploaded:function(b,d){d.info=d.info||{};if(a.picVote.getIsPicCut()){a.picVote.setIsPicCut(false);var e=g(l(b),".pic img")[0];UI.A(e,"cut",1)}a._addPic({result:d.result,msg:d.msg,info:{image:d.info.url,path:d.info.path||"",local:d.info.localUrl||"",fileName:d.info.name||_("图片.jpg"),picId:b,makeup:d.info.makeup||0}})},_jf_afterMakeUp:function(){MI.MakeUpPic.hide()},_jf_onSelectError:function(a){MI.alert(a)},_jf_getImgUrls:function(){var b={};b.index=a.curPic||0;b.imgs=[];UI.each(a._getSortPics(),function(d){var e=d.id,d=d.src;if(a.picVote.getIsPicCut()){var h=g(l(e),".pic img")[0],h=UI.A(h,"orign");h!==""&&(d=h)}d=d+(d.hasString("qpic.cn")?"/2000":"");b.imgs.push({url:d,picId:e})});return b},_jf_getRestPicsNum:function(){a.attachStatus==7&&a._boss("btnAddPicVoteSwf");clearTimeout(a.delay.blur);return a.maxPics-g(a._getPicList(),".sendPicBlock").length},_jf_getMaxPicsNum:function(){return a.maxPics},_jf_getUploadUrl:function(){return MI.url.uploadGrabPic+"?call=2&uin="+MI.user.uin+"&g_tk="+v},_jf_isPicCut:function(){return a.picVote.getIsPicCut()},_jf_isSquareCut:function(){return a.attachStatus==7},_jf_getPs:function(){return{_ps1:MI.psKey(),_ps2:MI.pslKey()}}};this.bind=function(){window.picCallback=b}}}};MI.NewTalkBox.ImgLoad=function(a){var b=parseInt(UI.A(a,"size"),10),c=UI.A(a,"mode"),d=parseInt(UI.A(a,"w"),10)||a.width,e=parseInt(UI.A(a,"h"),10)||a.height,c=c==""?5:parseInt(c,10),b=MI.calcImgInfo({w:b,h:b},{w:d,h:e},{mode:c}),c=UI.A(a,"src");if(!(c===MI.NewTalkBox.prototype.defaultThumb||c.indexOf("base64")!==-1)){UI.C(a,"position","relative");UI.C(a,"width",b.width+"px");UI.C(a,"height",b.height+"px");UI.C(a,"left",b.left+"px");UI.C(a,"top",b.top+"px");UI.A(a,"w",d);UI.A(a,"h",e)}};MI.MakeUpPic={html:'<div class="filterPic" style="width:633px;padding:5px 0;text-align:center"><div class="flashWrap"></div><div class="clear"><p class="left" style="padding:10px 0 0 0"><a href="http://app.t.qq.com/app/intro/170278?via=170278_WB.TQQ.ADDTWEET" boss="btnPicCamera360" class="camera360 c_tx5" target="_blank"><i class="ico_camera360"></i><span>Powered by Camera360 ['+_("相机")+'360]</span></a></p><p style="text-align:right;padding:5px;" class="btnBox"><span class="error" style="padding-right:20px"></span><button class="btn3 btnSend">'+_("确定")+'</button>&nbsp;<button class="btnCancel btn_cancel">'+_("取消")+"</button></p></div></div>",flashHtml:"",body:null,talkBox:null,sendBtn:null,cancelBtn:null,uploadUrl:"",uploading:!1,build:function(a,b){var c=this;if(!c.uploading)if(MI.Flash.getVersion()<9)MI.dialog.show({html:MI.Flash.updateTip(9)});else{c.flashHtml=MI.Flash.getObject(null,MI.swf.MakeUpPic,630,374,"MakeUpPic");c.uploadUrl=a;if(c.body)c.show();else{c.body=UI.html(c.html)[0];c.talkBox=b;c.sendBtn=g(c.body,".btnSend")[0];c.cancelBtn=g(c.body,".btnCancel")[0];c.tip=g(c.body,".error")[0];c.flashWrap=g(c.body,".flashWrap")[0];c.sendBtn.onclick=function(){c.upload();c.talkBox.attachStatus==7&&c.talkBox._boss("btnPicVoteCutUpload")};c.cancelBtn.onclick=function(){c.hide()};c.show();return false}}},show:function(){this.flashWrap.innerHTML=this.flashHtml;MI.dialog.show({title:'<h3 class="DmainTit">'+_("美化图片")+"</h3>",html:this.body,width:662,start:function(){},end:function(){}})},upload:function(){document.MakeUpPic._fj_upload&&document.MakeUpPic._fj_upload()},hide:function(){MI.dialog.hide();UI.C(MI.dialog._body,"visibility","");this.uploading=false},flyAway:function(){UI.C(MI.dialog._body,"visibility","hidden");this.uploading=true},toggleBodyScroll:function(a){var b=document.body,c=b.parentNode;if(a)setTimeout(function(){UI.C(b,"overflow","hidden");UI.C(c,"overflow","hidden");setTimeout(function(){MI.GoTop.position()},1)},100);else{UI.C(c,"overflow","");UI.C(b,"overflow","");setTimeout(function(){MI.GoTop.position()},1)}}};return MI.NewTalkBox});/*version:148024*//*  |xGv00|9c3a31b66ede42730b345c762d56fe91 */